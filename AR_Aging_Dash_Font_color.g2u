Program.Sub.ScreenSU.Start
Gui.FrmAging..Create
Gui.FrmAging..Caption("AR Review")
Gui.FrmAging..Size(15300,10395)
Gui.FrmAging..MinX(0)
Gui.FrmAging..MinY(0)
Gui.FrmAging..Position(0,0)
Gui.FrmAging..BackColor(-2147483633)
Gui.FrmAging..MousePointer(0)
Gui.FrmAging..Event(UnLoad,FrmAging_UnLoad)
Gui.FrmAging..Event(Resize,frmAging_Resize)
Gui.FrmAging.framePermissions.Create(Frame)
Gui.FrmAging.framePermissions.Size(1965,390)
Gui.FrmAging.framePermissions.Position(13200,15)
Gui.FrmAging.optView.Create(Option)
Gui.FrmAging.optView.Size(690,195)
Gui.FrmAging.optView.Position(225,150)
Gui.FrmAging.optView.Caption("View")
Gui.FrmAging.optView.Parent("framePermissions")
Gui.FrmAging.optEdit.Create(Option)
Gui.FrmAging.optEdit.Size(645,195)
Gui.FrmAging.optEdit.Position(1050,150)
Gui.FrmAging.optEdit.Caption("Edit")
Gui.FrmAging.optEdit.Enabled(False)
Gui.FrmAging.optEdit.Parent("framePermissions")
Gui.FrmAging.picGSSLogo.Create(PictureBox)
Gui.FrmAging.picGSSLogo.Size(4125,960)
Gui.FrmAging.picGSSLogo.Position(5550,45)
Gui.FrmAging.picGSSLogo.Event(DblClick,picGSSLogo_DblClick)
Gui.FrmAging.picGSSLogo.ToolTip("Double-Click for additional functions")
Gui.FrmAging.pbStatus.Create(ProgressBar)
Gui.FrmAging.pbStatus.Visible(False)
Gui.FrmAging.pbStatus.Size(1620,255)
Gui.FrmAging.pbStatus.Position(2220,300)
Gui.FrmAging.lblStatus.Create(Label,"Loading AR Aging....",False,1620,255,0,2220,90,True,0,"Arial",8,-986896,0)
Gui.FrmAging.dtpAgeDate.Create(DatePicker)
Gui.FrmAging.dtpAgeDate.Size(1425,285)
Gui.FrmAging.dtpAgeDate.Position(45,240)
Gui.FrmAging.dtpAgeDate.Event(Change,dtpAgeDate_Change)
Gui.FrmAging.chkShowZero.Create(CheckBox)
Gui.FrmAging.chkShowZero.Size(1875,225)
Gui.FrmAging.chkShowZero.Position(45,585)
Gui.FrmAging.chkShowZero.Caption("Show Zero Balance")
Gui.FrmAging.lblAgingDt.Create(Label,"Aging Date:",True,1020,195,0,45,75,True,0,"Arial",8,-2147483633,0)
Gui.FrmAging.tabAR.Create(Tab)
Gui.FrmAging.tabAR.Size(15120,9060)
Gui.FrmAging.tabAR.Position(45,1065)
Gui.FrmAging.tabAR.Event(Click,tabAR_Click)
Gui.FrmAging.tabAR.Tabs(4)
Gui.FrmAging.tabAR.SetTab(0)
Gui.FrmAging.tabAR.Caption("AR Aging")
Gui.FrmAging.tabAR.SetTab(1)
Gui.FrmAging.tabAR.Caption("Overdue Invoices")
Gui.FrmAging.tabAR.SetTab(2)
Gui.FrmAging.tabAR.Caption("Statements")
Gui.FrmAging.tabAR.SetTab(3)
Gui.FrmAging.tabAR.Caption("Analysis")
Gui.FrmAging.GSGCAging.Create(GsGridControl)
Gui.FrmAging.GSGCAging.Size(15060,8640)
Gui.FrmAging.GSGCAging.Position(0,0)
Gui.FrmAging.GSGCAging.Event(RowCellClick,GSGCAging_RowCellClick)
Gui.FrmAging.GSGCAging.Parent("tabAR",0)
Gui.FrmAging.GSGCOverdue.Create(GsGridControl)
Gui.FrmAging.GSGCOverdue.Size(15060,8640)
Gui.FrmAging.GSGCOverdue.Position(0,0)
Gui.FrmAging.GSGCOverdue.Parent("tabAR",1)
Gui.FrmAging.GSGCOverdue.Event(RowCellClick,GSGCOverdue_RowCellClick)
Gui.FrmAging.GSGCOverdue.Event(CellValueChanged,GSGCOverdue_CellValueChanged)
Gui.FrmAging.gsChartAging.Create(gschart)
Gui.FrmAging.gsChartAging.Size(7455,8610)
Gui.FrmAging.gsChartAging.Position(30,30)
Gui.FrmAging.gsChartAging.Parent("tabAR",3)
Gui.FrmAging.gsChartTopTen.Create(gschart)
Gui.FrmAging.gsChartTopTen.Parent("tabAR",3)
Gui.FrmAging.gsChartTopTen.Size(7455,8610)
Gui.FrmAging.gsChartTopTen.Position(7530,30)
Gui.FrmAging.GSGCStatements.Create(GsGridControl)
Gui.FrmAging.GSGCStatements.Size(15060,8640)
Gui.FrmAging.GSGCStatements.Position(0,0)
Gui.FrmAging.GSGCStatements.Parent("tabAR",2)
Gui.FrmAging.GSGCStatements.Event(RowCellClick,GSGCStatements_RowCellClick)
Gui.FrmAging.cmdRefresh.Create(Button)
Gui.FrmAging.cmdRefresh.Size(645,375)
Gui.FrmAging.cmdRefresh.Position(1530,195)
Gui.FrmAging.cmdRefresh.Caption("REFRESH")
Gui.FrmAging.cmdRefresh.Event(Click,cmdRefresh_Click)
Gui.FrmAging.frameAgeOpt.Create(Frame)
Gui.FrmAging.frameAgeOpt.Size(1965,825)
Gui.FrmAging.frameAgeOpt.Position(13170,420)
Gui.FrmAging.frameAgeOpt.Caption("Age")
Gui.FrmAging.frameAgeOpt.Anchor(9)
Gui.FrmAging.optAgeDueDate.Create(Option)
Gui.FrmAging.optAgeDueDate.Size(1290,255)
Gui.FrmAging.optAgeDueDate.Position(75,225)
Gui.FrmAging.optAgeDueDate.Parent("frameAgeOpt")
Gui.FrmAging.optAgeDueDate.Caption("by Due Date")
Gui.FrmAging.optAgeDueDate.Event(Click,SaveAgingOption)
Gui.FrmAging.optAgeInvoiceDate.Create(Option)
Gui.FrmAging.optAgeInvoiceDate.Size(1560,255)
Gui.FrmAging.optAgeInvoiceDate.Position(75,495)
Gui.FrmAging.optAgeInvoiceDate.Parent("frameAgeOpt")
Gui.FrmAging.optAgeInvoiceDate.Caption("by Invoice Date")
Gui.FrmAging.optAgeInvoiceDate.Event(Click,SaveAgingOption)
Gui.FrmAging.ddlFilter.Create(DropDownList)
Gui.FrmAging.ddlFilter.Size(2310,330)
Gui.FrmAging.ddlFilter.Position(45,600)
Gui.FrmAging.ddlFilter.Visible(False)
Gui.FrmAging.ddlContact.Create(DropDownList)
Gui.FrmAging.ddlContact.Visible(False)
Gui.FrmAging.ddlContact.Size(2250,330)
Gui.FrmAging.ddlContact.Position(2400,600)
Gui.FrmAging.dtpStateDate.Create(DatePicker)
Gui.FrmAging.dtpStateDate.Visible(False)
Gui.FrmAging.dtpStateDate.Size(1425,285)
Gui.FrmAging.dtpStateDate.Position(45,240)
Gui.FrmAging.cmdSendEmails.Create(Button)
Gui.FrmAging.cmdSendEmails.Visible(False)
Gui.FrmAging.cmdSendEmails.Size(1095,375)
Gui.FrmAging.cmdSendEmails.Position(14070,870)
Gui.FrmAging.cmdSendEmails.Anchor(9)
Gui.FrmAging.cmdSendEmails.Caption("Send Emails")
Gui.FrmAging.cmdSendEmails.Event(Click,cmdSendEmails_Click)
Gui.frmEInvoice..Create
Gui.frmEInvoice..Caption("E-Invoicing")
Gui.frmEInvoice..Size(6000,1845)
Gui.frmEInvoice..MinX(0)
Gui.frmEInvoice..MinY(0)
Gui.frmEInvoice..Position(0,0)
Gui.frmEInvoice..BackColor(-2147483633)
Gui.frmEInvoice..MousePointer(0)
Gui.frmEInvoice.lbl1.Create(Label,"***CHANGE***",True,3735,255,0,1080,225,True,2,"Arial",12,-986896,0)
Gui.frmEInvoice.progressBar1.Create(ProgressBar)
Gui.frmEInvoice.progressBar1.Size(3735,255)
Gui.frmEInvoice.progressBar1.Position(1080,705)
Gui.frmStatementView..Create
Gui.frmStatementView..Caption("AR Statement View")
Gui.frmStatementView..Size(15120,14130)
Gui.frmStatementView..MinX(0)
Gui.frmStatementView..MinY(0)
Gui.frmStatementView..Position(0,0)
Gui.frmStatementView..BackColor(-2147483633)
Gui.frmStatementView..MousePointer(0)
Gui.frmStatementView..Event(UnLoad,frmStatementView_UnLoad)
Gui.frmStatementView.htmlView.Create(HtmlContainer)
Gui.frmStatementView.htmlView.Size(14955,13755)
Gui.frmStatementView.htmlView.Position(15,15)
Gui.frmStatementView.htmlView.Anchor(15)
Gui.frmEmail..Create
Gui.frmEmail..Size(7140,6840)
Gui.frmEmail..MinX(7140)
Gui.frmEmail..MinY(6840)
Gui.frmEmail..Position(0,0)
Gui.frmEmail..BackColor(-2147483633)
Gui.frmEmail..MousePointer(0)
Gui.frmEmail..Event(UnLoad,frmEmail_UnLoad)
Gui.frmEmail..Caption("Edit Email")
Gui.frmEmail..MaxButton(False)
Gui.frmEmail..Sizeable(False)
Gui.frmEmail.txtBody.Create(TextboxM)
Gui.frmEmail.txtBody.Size(6915,3810)
Gui.frmEmail.txtBody.Position(75,2310)
Gui.frmEmail.txtSubject.Create(TextboxM)
Gui.frmEmail.txtSubject.Size(6915,300)
Gui.frmEmail.txtSubject.Position(75,1665)
Gui.frmEmail.txtSubject.MaxLength(225)
Gui.frmEmail.lblBody.Create(Label,"Body:",True,660,255,0,75,2085,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblSubject.Create(Label,"Subject:",True,765,255,0,75,1440,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.txtSName.Create(TextBox,"",True,3375,300,0,75,360,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtSName.MaxLength(100)
Gui.frmEmail.txtRName.Create(TextBox,"",True,3375,300,0,75,975,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtRName.MaxLength(100)
Gui.frmEmail.txtSEmail.Create(TextBox,"",True,3375,300,0,3570,360,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtSEmail.MaxLength(100)
Gui.frmEmail.txtREmail.Create(TextBox,"",True,3375,300,0,3570,975,True,0,"Arial",8,-2147483643,1)
Gui.frmEmail.txtREmail.MaxLength(100)
Gui.frmEmail.lblSName.Create(Label,"Sender Name:",True,1200,210,0,45,135,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblSEmail.Create(Label,"Sender Email:",True,1200,210,0,3540,135,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblREmail.Create(Label,"Recipient Email:",True,1305,210,0,3540,750,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.lblRName.Create(Label,"Recipient Name:",True,1350,210,0,45,750,True,0,"Arial",8,-2147483633,0)
Gui.frmEmail.cmdSave.Create(Button)
Gui.frmEmail.cmdSave.Size(855,330)
Gui.frmEmail.cmdSave.Position(75,6150)
Gui.frmEmail.cmdSave.Caption("Save")
Gui.frmEmail.cmdSave.Event(Click,cmdSavePreview_Click)
Gui.frmEmail.txtRow.Create(TextBox,"",False,330,300,0,6660,6165,True,0,"Arial",8,-2147483643,1)
Program.Sub.ScreenSU.End

Program.Sub.Preflight.Start
	V.Global.sCust.Declare
	V.Global.sInV.Declare
	V.Global.sOrderNo.Declare
	V.Global.sCustPO.Declare
	V.Global.sCustomerName.Declare
	v.Global.sInvoiceMode.Declare
	V.Global.bLoadData.Declare
	V.Global.bLoadDataStatements.Declare

	v.Global.fCur.Declare
	v.Global.fPd2.Declare
	v.Global.fPd3.Declare
	v.Global.fPd4.Declare
	v.Global.fPd5.Declare
	v.Global.fPd6.Declare
	v.Global.fPd7.Declare
	v.Global.fPd8.Declare
	v.Global.fPd9.Declare
	v.Global.fPd10.Declare
	v.Global.fPd11.Declare
	v.Global.fPd12.Declare
	v.Global.fPd13.Declare
	v.Global.fOver.Declare

	v.Global.fCurRpt.Declare
	v.Global.fPd2Rpt.Declare
	v.Global.fPd3Rpt.Declare
	v.Global.fPd4Rpt.Declare
	v.Global.fPd5Rpt.Declare
	v.Global.fPd6Rpt.Declare
	v.Global.fPd7Rpt.Declare
	v.Global.fPd8Rpt.Declare
	v.Global.fPd9Rpt.Declare
	v.Global.fPd10Rpt.Declare
	v.Global.fPd11Rpt.Declare
	v.Global.fPd12Rpt.Declare
	v.Global.fPd13Rpt.Declare
	v.Global.fOverRpt.Declare

	v.Global.iCurEnd.Declare(long,0)
	v.Global.iPd2End.Declare(long,30)
	v.Global.iPd3End.Declare(long,60)
	v.Global.iPd4End.Declare(long,90)
	v.Global.iPd5End.Declare(long,120)
	v.Global.iPd6End.Declare(long,150)
	v.Global.iPd7End.Declare(long,180)
	v.Global.iPd8End.Declare(long,210)
	v.Global.iPd9End.Declare(long,240)
	v.Global.iPd10End.Declare(long,270)
	v.Global.iPd11End.Declare(long,300)
	v.Global.iPd12End.Declare(long,330)
	v.Global.iPd13End.Declare(long,360)
	v.Global.iOverStart.Declare(long,360)

	V.Global.sCaption2.Declare
	V.Global.sCaption3.Declare
	V.Global.sCaption4.Declare
	V.Global.sCaption5.Declare
	V.Global.sCaption6.Declare
	V.Global.sCaption7.Declare
	V.Global.sCaption8.Declare
	V.Global.sCaption9.Declare
	V.Global.sCaption10.Declare
	V.Global.sCaption11.Declare
	V.Global.sCaption12.Declare
	V.Global.sCaption13.Declare
	V.Global.sCaptionOver.Declare

	v.Global.iCurEndRpt.Declare(long,0)
	v.Global.iPd2EndRpt.Declare(long,30)
	v.Global.iPd3EndRpt.Declare(long,60)
	v.Global.iPd4EndRpt.Declare(long,90)
	v.Global.iPd5EndRpt.Declare(long,120)
	v.Global.iPd6EndRpt.Declare(long,150)
	v.Global.iPd7EndRpt.Declare(long,180)
	v.Global.iPd8EndRpt.Declare(long,210)
	v.Global.iPd9EndRpt.Declare(long,240)
	v.Global.iPd10EndRpt.Declare(long,270)
	v.Global.iPd11EndRpt.Declare(long,300)
	v.Global.iPd12EndRpt.Declare(long,330)
	v.Global.iPd13EndRpt.Declare(long,360)
	v.Global.iOverStartRpt.Declare(long,360)

	v.Global.bPrintInvoice.Declare
	v.Global.bNewARBatches.Declare
	v.Global.bCustomerStatements.Declare
	v.Global.bAROpen.Declare
	v.Global.bEinvoicing.Declare

'	Program.External.Include.Library("PPT_Canny.lib")
Program.Sub.Preflight.End

Program.Sub.Main.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	v.Local.sIcon.Declare
	v.Local.sGsslogo.Declare
	v.Local.bGroup.Declare

	F.Intrinsic.String.Build("{0}\ART\gss2.ico",V.Caller.GlobalDir,v.Local.sIcon)		
	F.Intrinsic.String.Build("{0}\ART\GAB_GSS_Logo_Green_Dash.png",V.Caller.GlobalDir,V.Local.sGssLogo)
	Gui.FrmAging..Icon(v.Local.sIcon)
	Gui.frmEInvoice..Icon(v.Local.sIcon)
	Gui.FrmAging.picGSSLogo.Picture(v.Local.sGsslogo)

	'Canny
'	F.Intrinsic.Control.CallSub(CannyCheckUser,"Form","FrmAging")

	Gui.FrmAging.optAgeDueDate.Value(True)
	Gui.FrmAging.tabAR.SetTab(0)

	F.Intrinsic.Control.CallSub(checkpermissions)
	F.Intrinsic.Control.CallSub(SetAnchors)
	F.Intrinsic.Control.CallSub(CheckAgingOption)

	F.ODBC.Connection!con.OpenCompanyConnection(500)

	F.Intrinsic.Control.CallSub(CheckTable)

	Gui.FrmAging.dtpAgeDate.Value(V.Ambient.Date)
	Gui.FrmAging..Show

	F.Intrinsic.Control.CallSub(SetContextMenus)
	F.Intrinsic.Control.CallSub(SetTabAnchors)
	F.Intrinsic.Control.CallSub(LoadCompanyOptions)
'	f.Intrinsic.Debug.ShowCallerInfo
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.Main.End

Program.Sub.CheckPermissions.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare
	v.Local.bChecked.Declare(boolean,false)

	'Check User Permissions: View
	Function.Global.Security.CheckUserAccessIPM(177,0,v.Global.bPrintInvoice) 'Order Entry > Reports > Reprint Invoice
	f.Intrinsic.Control.If(v.Global.bPrintInvoice)
		Gui.FrmAging.optView.Enabled(True)
		f.Intrinsic.Control.If(v.Local.bChecked,=,False)
			Gui.FrmAging.optView.Value(True)
			v.Local.bChecked.Set(True)		
		f.Intrinsic.Control.EndIf		
	f.Intrinsic.Control.Else
		Gui.FrmAging.optView.Enabled(False)
		Gui.FrmAging.optView.Value(False)
		v.Local.bChecked.Set(False)
	f.Intrinsic.Control.EndIf

	'Check User Permissions: Edit
	Function.Global.Security.CheckUserAccessIPM(93,2,v.Global.bNewARBatches) 'Accounts Receivable > Transactions > AR Batches > New
	f.Intrinsic.Control.If(v.Global.bNewARBatches)
		Gui.FrmAging.optEdit.Enabled(True)
		f.Intrinsic.Control.If(v.Local.bChecked,=,False)
			Gui.FrmAging.optEdit.Value(True)
			v.Local.bChecked.Set(True)		
		f.Intrinsic.Control.EndIf		
	f.Intrinsic.Control.Else
		Gui.FrmAging.optEdit.Enabled(False)
		Gui.FrmAging.optEdit.Value(False)
		v.Local.bChecked.Set(False)
	f.Intrinsic.Control.EndIf

	Function.Global.Security.CheckUserAccessIPM(101,0,v.Global.bCustomerStatements) 'Accounts Receivable > Reports > Statements
	Function.Global.Security.CheckUserAccessIPM(90,0,v.Global.bAROpen) 'Accounts Receivable > View > AR Open Items and History
	Function.Global.Security.CheckUserAccessIPM(1021,0,v.Global.bEinvoicing) 'Order Entry > Transactions > E-Invoicing Review

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckPermissions.End

Program.Sub.FrmAging_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.If(V.Global.bLoadData)
		F.Intrinsic.Control.CallSub(Serialize)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.If(V.Global.bLoadDataStatements)
		F.Intrinsic.Control.CallSub(SerializeStatements)
	F.Intrinsic.Control.EndIf

	F.ODBC.Connection!con.Close
	F.Intrinsic.Control.End 

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.FrmAging_UnLoad.End

Program.Sub.frmAging_Resize.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.fWBase.Declare
	V.Local.fHBase.Declare

	F.Intrinsic.Math.Sub(v.Screen.FrmAging!tabAR.Width,15120,v.Local.fWBase)

	F.Intrinsic.Math.Sub(v.Screen.FrmAging!tabAR.Height,450,v.Local.fHBase)

	F.Intrinsic.Math.Div(v.Local.fWBase,2,v.Local.fWBase)

	F.Intrinsic.Math.Add(7455,v.Local.fWBase,v.Local.fWBase)

	Gui.FrmAging.gsChartAging.Size(v.Local.fWBase,V.Local.fHBase)
	Gui.FrmAging.gsChartTopTen.Size(v.Local.fWBase,V.Local.fHBase)

	F.Intrinsic.Math.Add(V.Screen.FrmAging!gsChartAging.Left,v.Screen.FrmAging!gsChartAging.Width,50,v.Local.fWBase)

	Gui.FrmAging.gsChartTopTen.Position(v.Local.fWBase,v.Screen.FrmAging!gsChartAging.Top)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmAging_Resize.End

Program.Sub.SetAnchors.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	'0 - None
	'1 - Top
	'2 - Bottom
	'4 - Left
	'8 - Right

	Gui.FrmAging.tabAR.Anchor(15)
	Gui.FrmAging.framePermissions.Anchor(9)
	Gui.FrmAging.picGSSLogo.Anchor(1)
	Gui.FrmAging.lblStatus.Anchor(5)
	Gui.FrmAging.pbStatus.Anchor(5)
	Gui.FrmAging.cmdRefresh.Anchor(5)
	Gui.FrmAging.dtpAgeDate.Anchor(5)
	Gui.FrmAging.lblAgingDt.Anchor(5)
	Gui.FrmAging.chkShowZero.Anchor(5)
	'Gui.FrmAging.lblCharts.Anchor(5)
	'Gui.FrmAging.frameAllCust.Anchor(13)
	'Gui.FrmAging.ChartAllCust.Anchor(13)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SetAnchors.End

Program.Sub.SetTabAnchors.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	'0 - None
	'1 - Top
	'2 - Bottom
	'4 - Left
	'8 - Right

	Gui.FrmAging.GSGCAging.Anchor(15)
	Gui.FrmAging.GSGCOverdue.Anchor(15)
	Gui.FrmAging.GSGCStatements.Anchor(15)

	'Set Dropdown List Values
	F.Intrinsic.Control.BlockEvents
	Gui.FrmAging.ddlFilter.AddItem("Customers with a Balance",0)
	Gui.FrmAging.ddlFilter.AddItem("Overdue Statements Only",1)
	Gui.FrmAging.ddlFilter.Text("Customers with a Balance")

	'Set Dropdown List Values
	Gui.FrmAging.ddlContact.AddItem("AR eInvoice Contacts",0)
	Gui.FrmAging.ddlContact.AddItem("CRM eInvoice Contacts",1)
	Gui.FrmAging.ddlContact.Text("AR eInvoice Contacts")
	F.Intrinsic.Control.UnBlockEvents

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SetTabAnchors.End

Program.Sub.LoadCompanyOptions.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	v.Local.iCaptionSt.Declare(long)
	v.Local.iCaptionEnd.Declare(long)

'	Function.Global.General.ReadOption(401066,3,v.Global.iCurEnd,v.Global.iCurEnd)
'	Function.Global.General.ReadOption(401067,3,v.Global.iPd2End,v.Global.iPd2End)
'	Function.Global.General.ReadOption(401068,3,v.Global.iOverStart,v.Global.iOverStart)

	Function.Intrinsic.Math.Add(v.Global.iCurEnd,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd2End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,V.Global.sCaption2)
'	F.Intrinsic.Debug.ShowCallerInfo

	Function.Intrinsic.Math.Add(v.Global.iPd2End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd3End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption3)

	Function.Intrinsic.Math.Add(v.Global.iPd3End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd4End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption4)

	Function.Intrinsic.Math.Add(v.Global.iPd4End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd5End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption5)

	Function.Intrinsic.Math.Add(v.Global.iPd5End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd6End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption6)

	Function.Intrinsic.Math.Add(v.Global.iPd6End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd7End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption7)

	Function.Intrinsic.Math.Add(v.Global.iPd7End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd8End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption8)

	Function.Intrinsic.Math.Add(v.Global.iPd8End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd9End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption9)

	Function.Intrinsic.Math.Add(v.Global.iPd9End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd10End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption10)

	Function.Intrinsic.Math.Add(v.Global.iPd10End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd11End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption11)

	Function.Intrinsic.Math.Add(v.Global.iPd11End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd12End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption12)

	Function.Intrinsic.Math.Add(v.Global.iPd12End,1,v.Local.iCaptionSt)
	v.Local.iCaptionEnd.Set(v.Global.iPd13End)
	Function.Intrinsic.String.Build("{0}-{1} ({2})",v.Local.iCaptionSt,v.Local.iCaptionEnd,V.Company.CurrencySymbol,v.Global.sCaption13)	

	f.Intrinsic.Math.Add(v.Global.iOverStart,1,v.Local.iCaptionSt)
	Function.Intrinsic.String.Build("Over {0} ({1})",v.Local.iCaptionSt,V.Company.CurrencySymbol,v.Global.sCaptionOver)
	'Function.Intrinsic.String.Build("Over {0} ({1})",v.Global.iOverStart,V.Company.CurrencySymbol,v.Global.sCaptionOver)

'	Function.Global.General.ReadOption(401072,3,v.Global.iCurEndRpt,v.Global.iCurEndRpt)
'	Function.Global.General.ReadOption(401073,3,v.Global.iPd2EndRpt,v.Global.iPd2EndRpt)
'	Function.Global.General.ReadOption(401074,3,v.Global.iPd3EndRpt,v.Global.iPd3EndRpt)
'	Function.Global.General.ReadOption(401075,3,v.Global.iOverStartRpt,v.Global.iOverStartRpt)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadCompanyOptions.End

Program.Sub.CheckTable.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.bRet.Declare

	F.ODBC.Connection!con.TableExists("GAB_4437_OVDUE_INVC",v.Local.bRet)
		F.Intrinsic.Control.If(v.Local.bRet,=,false)
			F.ODBC.Connection!con.Execute("CREATE TABLE GAB_4437_OVDUE_INVC(INVOICE VARCHAR(10),NOTE_1 LONGVARCHAR,CHANGE_DATE VARCHAR(15),CHANGE_USER VARCHAR(20));")
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckTable.End

Program.Sub.CheckAgingOption.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.bRet.Declare

	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",5435,2000,0,"",V.Local.bRet)
	F.Intrinsic.Control.If(V.Local.bRet,=,False)
		Gui.FrmAging.optAgeDueDate.Value(True)
	F.Intrinsic.Control.Else
		Gui.FrmAging.optAgeInvoiceDate.Value(True)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckAgingOption.End

Program.Sub.SaveAgingOption.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.If(V.Screen.FrmAging!optAgeDueDate.Value)
		F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",5435,2000,False,"Aging Option (DueDate)",False,0,-999.0,1/1/1980,12:00:00 AM)
	F.Intrinsic.Control.Else
		F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"OCTSRS.NET.EXE",5435,2000,False,"Aging Option (InvoiceDate)",True,0,-999.0,1/1/1980,12:00:00 AM)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SaveAgingOption.End

Program.Sub.SetContextMenus.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.FrmAging..ContextMenuCreate("ctxAging")
	Gui.FrmAging.GSGCAging.ContextMenuAttach("ctxAging")
	Gui.FrmAging..ContextMenuAddItem("ctxAging","Refresh",0,"Refresh")
	Gui.FrmAging..ContextMenuAddItem("ctxAging","Export",0,"Export")
	Gui.FrmAging..ContextMenuAddItem("ctxAging","ResetColumns",0,"Reset Columns")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxAging","Refresh","MenuClickRefresh")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxAging","Export","MenuClickExport")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxAging","ResetColumns","MenuClickResetColumns")

	Gui.FrmAging..ContextMenuCreate("ctxOverdue")
	Gui.FrmAging.GSGCOverdue.ContextMenuAttach("ctxOverdue")
	Gui.FrmAging..ContextMenuAddItem("ctxOverdue","Refresh",0,"Refresh")
	Gui.FrmAging..ContextMenuAddItem("ctxOverdue","Export",0,"Export")
	Gui.FrmAging..ContextMenuAddItem("ctxOverdue","ResetColumns",0,"Reset Columns")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxOverdue","Refresh","MenuClickRefresh")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxOverdue","Export","MenuClickExport")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxOverdue","ResetColumns","MenuClickResetColumns")

	Gui.FrmAging..ContextMenuCreate("xtcStatements")
	Gui.FrmAging.GSGCStatements.ContextMenuAttach("xtcStatements")
	Gui.FrmAging..ContextMenuAddItem("xtcStatements","SelAll",0,"Select All")
	Gui.FrmAging..ContextMenuAddItem("xtcStatements","DeselAll",0,"Deselect All")
	Gui.FrmAging..ContextMenuAddItem("xtcStatements","Exp",3)
	Gui.FrmAging..ContextMenuAddItem("xtcStatements","Refresh",0,"Refresh")
	Gui.FrmAging..ContextMenuAddItem("xtcStatements","Export",0,"Export")
	Gui.FrmAging..ContextMenuAddItem("xtcStatements","Reset",0,"Reset Columns")
	Gui.FrmAging..ContextMenuSetItemEventHandler("xtcStatements","SelAll","MenuClickStatments")
	Gui.FrmAging..ContextMenuSetItemEventHandler("xtcStatements","DeselAll","MenuClickStatments")
	Gui.FrmAging..ContextMenuSetItemEventHandler("xtcStatements","Refresh","MenuClickStatments")
	Gui.FrmAging..ContextMenuSetItemEventHandler("xtcStatements","Export","MenuClickStatments")
	Gui.FrmAging..ContextMenuSetItemEventHandler("xtcStatements","Reset","MenuClickStatments")

	Gui.FrmAging..ContextMenuCreate("ctxChart")
	Gui.FrmAging.gsChartAging.ContextMenuAttach("ctxChart")
	Gui.FrmAging..ContextMenuAddItem("ctxChart","Export",0,"Export")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxChart","Export","MenuClickExport")

	Gui.FrmAging..ContextMenuCreate("ctxTop")
	Gui.FrmAging.gsChartTopTen.ContextMenuAttach("ctxTop")
	Gui.FrmAging..ContextMenuAddItem("ctxTop","Export",0,"Export")
	Gui.FrmAging..ContextMenuSetItemEventHandler("ctxTop","Export","MenuClickExport")

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SetContextMenus.End

Program.Sub.MenuClickRefresh.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.CallSub(cmdRefresh_Click)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickRefresh.End

Program.Sub.MenuClickExport.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sFileExport.Declare
	V.Local.bExcel.Declare
	V.Local.bFileLocked.Declare
	V.Local.sMsg.Declare
	V.Local.sControl.Declare
	V.Local.bChart.Declare

	F.Intrinsic.Control.SelectCase(V.Args.MenuName)
		F.Intrinsic.Control.Case("CTXAGING")
			V.Local.sControl.Set("GSGCAging")
			V.Local.bChart.Set(False)
		F.Intrinsic.Control.Case("CTXOVERDUE")
			V.Local.sControl.Set("GSGCOverdue")
			V.Local.bChart.Set(False)
		F.Intrinsic.Control.Case("CTXCHART")
			V.Local.sControl.Set("gsChartAging")
			V.Local.bChart.Set(True)
		F.Intrinsic.Control.Case("CTXTOP")
			V.Local.sControl.Set("gsChartTopTen")
			V.Local.bChart.Set(True)
	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.If(V.Local.bChart,=,False)
		F.Automation.MSExcel.CheckPresence(V.Local.bExcel)
		F.Intrinsic.Control.If(V.Local.bExcel)
			F.Intrinsic.String.Build("{0}\GAB_4437_{1}_Export.xlsx",V.Caller.LocalGssTempDir,V.Local.sControl,V.Local.sFileExport)
			F.Intrinsic.File.IsFileLocked(V.Local.sFileExport,V.Local.bFileLocked)
			F.Intrinsic.Control.If(V.Local.bFileLocked)
				F.Intrinsic.String.Build("File is already open. Please close and export again.{0}File: {1}",V.Ambient.NewLine,V.Local.sFileExport,V.Local.sMsg)
				F.Intrinsic.UI.Msgbox(V.Local.sMsg,"File In Use")
			F.Intrinsic.Control.Else
				Gui.FrmAging.[V.Local.sControl].Export(V.Local.sFileExport,"xlsx")
				F.Intrinsic.Task.ShellExec(0,"",V.Local.sFileExport,"","",1)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Else
			F.Intrinsic.String.Build("{0}\GAB_4437_{1}_Export.csv",V.Caller.LocalGssTempDir,V.Local.sControl,V.Local.sFileExport)
			F.Intrinsic.File.IsFileLocked(V.Local.sFileExport,V.Local.bFileLocked)
			F.Intrinsic.Control.If(V.Local.bFileLocked)
				F.Intrinsic.String.Build("File is already open. Please close and export again.{0}File: {1}",V.Ambient.NewLine,V.Local.sFileExport,V.Local.sMsg)
				F.Intrinsic.UI.Msgbox(V.Local.sMsg,"File In Use")
			F.Intrinsic.Control.Else
				Gui.FrmAging.[V.Local.sControl].Export(V.Local.sFileExport,"csv")
			F.Intrinsic.Control.EndIf
			F.Intrinsic.Task.ShellExec(0,"",V.Local.sFileExport,"","",1)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Build("{0}\{1}.jpg",V.Caller.LocalGSSTempDir,V.Local.sControl,V.Local.sFileExport)
		Gui.FrmAging.[V.Local.sControl].ImageToFile("JPEG",V.Local.sFileExport)
		F.Intrinsic.Task.ShellExec(0,"Open",V.Local.sFileExport,"","",0)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickExport.End

Program.Sub.MenuClickResetColumns.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.SelectCase(V.Args.MenuName)
		F.Intrinsic.Control.Case("CTXAGING")
			F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVAGING",5435,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,"")
		F.Intrinsic.Control.Case("CTXOVERDUE")
			F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVOVERDUE",5435,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,"")
	F.Intrinsic.Control.EndSelect

	V.Global.bLoadData.Set(False)
	F.Intrinsic.Control.CallSub(cmdRefresh_Click)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickResetColumns.End

Program.Sub.MenuClickStatments.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.bExcel.Declare
	V.Local.bFileLocked.Declare
	V.Local.sMsg.Declare
	V.Local.sExt.Declare
	V.Local.sFileExport.Declare
	V.Local.iRow.Declare

	F.Intrinsic.Control.If(V.DataTable.dtStatements.Exists,=,False)
		F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.SelectCase(V.Args.ItemName)
		F.Intrinsic.Control.Case("SELALL")
			F.Data.DataTable.SetValue("dtStatements",-1,"SEL",True)

		F.Intrinsic.Control.Case("DESELALL")
			F.Data.DataTable.SetValue("dtStatements",-1,"SEL",False)

		F.Intrinsic.Control.Case("REFRESH")
			F.Intrinsic.Control.CallSub(ddlFilter_Click)

		F.Intrinsic.Control.Case("EXPORT")
			F.Automation.MSExcel.CheckPresence(V.Local.bExcel)
			F.Intrinsic.Control.If(V.Local.bExcel)
				V.Local.sExt.Set("xlsx")
			F.Intrinsic.Control.Else
				V.Local.sExt.Set("csv")
			F.Intrinsic.Control.EndIf

			F.Intrinsic.String.Build("{0}\GAB_4437_Statements.{1}",V.Caller.LocalGssTempDir,V.Local.sExt,V.Local.sFileExport)
			F.Intrinsic.File.IsFileLocked(V.Local.sFileExport,V.Local.bFileLocked)
			F.Intrinsic.Control.If(V.Local.bFileLocked)
				F.Intrinsic.String.Build("File is already open. Please close and export again.{0}File: {1}",V.Ambient.NewLine,V.Local.sFileExport,V.Local.sMsg)
				F.Intrinsic.UI.Msgbox(V.Local.sMsg,"File In Use")
			F.Intrinsic.Control.Else
				Gui.FrmAging.GSGCStatements.Export(V.Local.sFileExport,V.Local.sExt)
				F.Intrinsic.Task.ShellExec(0,"",V.Local.sFileExport,"","",1)
			F.Intrinsic.Control.EndIf

		F.Intrinsic.Control.Case("RESET")
			F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVSTATEMENTS",5435,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,"")
			V.Global.bLoadDataStatements.Set(False)
			F.Intrinsic.Control.CallSub(ddlFilter_Click)

	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.MenuClickStatments.End

Program.Sub.cmdRefresh_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.SelectCase(V.Screen.FrmAging!tabAR.Tab)
		F.Intrinsic.Control.Case(0)
			F.Intrinsic.Control.If(V.Global.bLoadData)
				F.Intrinsic.Control.CallSub(Serialize)
			F.Intrinsic.Control.EndIf

			F.Intrinsic.Control.BlockEvents
			Gui.FrmAging.lblStatus.Visible(True)
			Gui.FrmAging.pbStatus.Visible(True)
			F.Intrinsic.Control.CallSub(loaddtage)
			F.Intrinsic.Control.CallSub(loaddtoverdue)
			F.Intrinsic.Control.CallSub(charts1)
			F.Intrinsic.Control.CallSub(charts2)
			Gui.FrmAging.lblStatus.Visible(False)
			Gui.FrmAging.pbStatus.Visible(False)
			F.Intrinsic.Control.UnBlockEvents
			Gui.FrmAging.cmdRefresh.BackColor(-2147483626)
			Gui.FrmAging.lblAgingDt.BackColor(-2147483633)
			F.Intrinsic.Control.CallSub(Deserialize)

		F.Intrinsic.Control.Case(2)
			F.Intrinsic.Control.CallSub(ddlFilter_Click)

	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdRefresh_Click.End

Program.Sub.tabAR_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.SelectCase(V.Screen.FrmAging!tabAR.Tab)
		F.Intrinsic.Control.Case(0)
			Gui.FrmAging.lblAgingDt.Visible(True)
			Gui.FrmAging.dtpAgeDate.Visible(True)
			Gui.FrmAging.chkShowZero.Visible(True)
			'Gui.FrmAging.frameTotals.Visible(True)
			'Gui.FrmAging.frameTotalOverdue.Visible(False)
			'Gui.FrmAging.lblCharts.Visible(False)
			Gui.FrmAging.cmdRefresh.Visible(True)
			Gui.FrmAging.frameAgeOpt.Visible(True)
			Gui.FrmAging.framePermissions.Visible(True)
			Gui.FrmAging.ddlFilter.Visible(False)
			Gui.FrmAging.ddlContact.Visible(False)
			Gui.FrmAging.dtpStateDate.Visible(False)
			Gui.FrmAging.cmdSendEmails.Visible(False)

		F.Intrinsic.Control.Case(1)
			Gui.FrmAging.lblAgingDt.Visible(False)
			Gui.FrmAging.dtpAgeDate.Visible(False)
			Gui.FrmAging.chkShowZero.Visible(False)
			'Gui.FrmAging.frameTotals.Visible(False)
			'Gui.FrmAging.frameTotalOverdue.Visible(True)
			'Gui.FrmAging.lblCharts.Visible(False)
			Gui.FrmAging.cmdRefresh.Visible(False)
			Gui.FrmAging.frameAgeOpt.Visible(False)
			Gui.FrmAging.framePermissions.Visible(False)
			Gui.FrmAging.ddlFilter.Visible(False)
			Gui.FrmAging.ddlContact.Visible(False)
			Gui.FrmAging.dtpStateDate.Visible(False)
			Gui.FrmAging.cmdSendEmails.Visible(False)

		F.Intrinsic.Control.Case(2)
			Gui.FrmAging.lblAgingDt.Visible(True)
			Gui.FrmAging.dtpAgeDate.Visible(False)
			Gui.FrmAging.chkShowZero.Visible(False)
			'Gui.FrmAging.frameTotals.Visible(False)
			'Gui.FrmAging.frameTotalOverdue.Visible(True)
			'Gui.FrmAging.lblCharts.Visible(False)
			Gui.FrmAging.cmdRefresh.Visible(True)
			Gui.FrmAging.frameAgeOpt.Visible(False)
			Gui.FrmAging.framePermissions.Visible(False)
			Gui.FrmAging.ddlFilter.Visible(True)
			Gui.FrmAging.ddlContact.Visible(True)
			Gui.FrmAging.dtpStateDate.Visible(True)
			Gui.FrmAging.cmdSendEmails.Visible(True)

		F.Intrinsic.Control.Case(3)
			Gui.FrmAging.lblAgingDt.Visible(False)
			Gui.FrmAging.dtpAgeDate.Visible(False)
			Gui.FrmAging.chkShowZero.Visible(False)
			'Gui.FrmAging.frameTotals.Visible(False)
			'Gui.FrmAging.frameTotalOverdue.Visible(False)
			'Gui.FrmAging.lblCharts.Visible(True)
			Gui.FrmAging.cmdRefresh.Visible(False)
			Gui.FrmAging.frameAgeOpt.Visible(False)
			Gui.FrmAging.framePermissions.Visible(False)
			Gui.FrmAging.ddlFilter.Visible(False)
			Gui.FrmAging.ddlContact.Visible(False)
			Gui.FrmAging.dtpStateDate.Visible(False)
			Gui.FrmAging.cmdSendEmails.Visible(False)

	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.tabAR_Click.End

Program.Sub.LoadDTAge.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare
	V.Local.dAgingDate.Declare
	V.Local.sFilter.Declare
	V.Local.iCnt.Declare
	V.Local.sSelect.Declare
	V.Local.sCustomer.Declare
	v.Local.sInvoice.Declare

	Gui.FrmAging.lblStatus.Caption("Loading AR Information....")

	F.Intrinsic.Control.If(V.DataTable.dtAging.Exists)
		F.Data.DataTable.Close("dtAging0")
		F.Data.DataTable.Close("dtAging")
'		F.Data.DataTable.Close("dtAge")
		F.Data.Dictionary.Close("dZero")
		F.Data.Dictionary.Close("dAge")
		F.Data.Dictionary.Close("dAge2")
		F.Data.Dictionary.Close("dAge3")
		F.Data.Dictionary.Close("dSO")
		F.Data.Dictionary.Close("dEmail")
		F.Data.Dictionary.Close("dTele")
	F.Intrinsic.Control.EndIf

	V.Global.bLoadData.Set(True)

	V.Local.dAgingDate.Set(V.Screen.FrmAging!dtpAgeDate.Value)

	F.Intrinsic.String.Build("SELECT RTrim(A.CUSTOMER) As CUSTOMER,B.NAME_CUSTOMER,A.TERRITORY As BRANCH,LTrim(RTrim(A.INVOICE)) As INVOICE,A.DATE_INVOICE,A.DATE_TRANSACTION,IF(A.DUE_DATE = '1900-01-01',NULL,A.DUE_DATE) AS DUE_DATE,CASE BATCH_CODE WHEN '10' THEN 'Invoice' WHEN '11' THEN 'Cash' WHEN '12' THEN 'Credit Memo' WHEN '13' THEN 'Adjustment' WHEN '16' THEN 'Fin. Charge' END AS TYPE,IF(REFUND_CK_NO <> '', RTrim(A.REFUND_CK_NO),RTrim(A.REFERENCE)) As REFERENCE,EXCHANGE_CURR,EXCHANGE_AMT,AMT_INVOICE,CONVERT(0,SQL_FLOAT) AS CURRENT1,CONVERT(0,SQL_FLOAT) AS TPD2,CONVERT(0,SQL_FLOAT) AS TPD3,CONVERT(0,SQL_FLOAT) AS TPD4,CONVERT(0,SQL_FLOAT) AS TPD5,CONVERT(0,SQL_FLOAT) AS TPD6,CONVERT(0,SQL_FLOAT) AS TPD7,CONVERT(0,SQL_FLOAT) AS TPD8,CONVERT(0,SQL_FLOAT) AS TPD9,CONVERT(0,SQL_FLOAT) AS TPD10,CONVERT(0,SQL_FLOAT) AS TPD11,CONVERT(0,SQL_FLOAT) AS TPD12,CONVERT(0,SQL_FLOAT) AS TPD13,CONVERT(0,SQL_FLOAT) AS OVER,CONVERT(0,SQL_FLOAT) AS NOT_AGED,'' AS COLUMN1,'Adjust' AS ADJUST,'' AS PAY,LTrim(RTrim(A.CUSTOMER))+Upper(LTrim(RTrim(A.INVOICE))) As CUSTINV FROM V_AR_OPEN_ITEMS A LEFT JOIN V_CUSTOMER_MASTER B ON A.CUSTOMER = B.CUSTOMER WHERE A.DATE_TRANSACTION <= '{0}' ORDER BY A.CUSTOMER,A.DATE_INVOICE,A.DATE_TRANSACTION;",V.Local.dAgingDate.PervasiveDate,V.Local.sSQL)
	F.Data.DataTable.CreateFromSQL("dtAging0","con",V.Local.sSQL,True)
	F.Data.DataTable.AddColumn("dtAging0","SALES_ORDER",String,"")
	F.Data.DataTable.AddColumn("dtAging0","EMAIL",String,"")
	F.Data.DataTable.AddColumn("dtAging0","TELEPHONE",String,"")
	F.Data.DataTable.AddColumn("dtAging0","ZERO",Float,0)
	F.Data.DataTable.AddColumn("dtAging0","AGE_CASH",Boolean,False)
	F.Data.DataTable.AddColumn("dtAging0","AGE_CASH2",Boolean,False)
	F.Data.DataTable.AddColumn("dtAging0","AGE_CASH3",Boolean,False)

	'Set Zeros
	F.Intrinsic.String.Build("SELECT Upper(LTrim(RTrim(Customer))+LTrim(RTrim(INVOICE))) As CUSTINV,SUM(AMT_INVOICE) FROM V_AR_OPEN_ITEMS WHERE DATE_TRANSACTION <= '{0}' GROUP BY CUSTOMER,INVOICE;",V.Local.dAgingDate.PervasiveDate,V.Local.sSQL)
	F.Data.Dictionary.CreateFromSQL("dZero","con",V.Local.sSQL)
	F.Data.Dictionary.SetDefaultReturn("dZero",0)
	F.Data.DataTable.FillFromDictionary("dtAging0","dZero","CUSTINV","ZERO")

	'Set Age flag for Cash Items
	F.Intrinsic.String.Build("Select LTrim(RTrim(Customer))+LTrim(RTrim(INVOICE)) As CUSTINV,Cast(If(Count(Invoice) > 1,1,0) as Bit) As AGE_CASH From V_AR_Open_Items Where Batch_Code In ('10','11') And Date_Transaction <= '{0}' Group By Customer,Invoice Order By Invoice;",V.Local.dAgingDate.PervasiveDate,V.Local.sSQL)
	F.Data.Dictionary.CreateFromSQL("dAge","con",V.Local.sSQL)
	F.Data.Dictionary.SetDefaultReturn("dAge",False)
	F.Data.DataTable.FillFromDictionary("dtAging0","dAge","CUSTINV","AGE_CASH")

	F.Intrinsic.String.Build("Select LTrim(RTrim(Customer))+LTrim(RTrim(INVOICE)) As CUSTINV,Cast(If(Count(Invoice) > 1,1,0) as Bit) As AGE_CASH From V_AR_Open_Items Where Batch_Code In ('10','12') And Date_Transaction <= '{0}' Group By Customer,Invoice Order By Invoice;",V.Local.dAgingDate.PervasiveDate,V.Local.sSQL)
	F.Data.Dictionary.CreateFromSQL("dAge2","con",V.Local.sSQL)
	F.Data.Dictionary.SetDefaultReturn("dAge2",False)
	F.Data.DataTable.FillFromDictionary("dtAging0","dAge2","CUSTINV","AGE_CASH2")

	F.Intrinsic.String.Build("Select LTrim(RTrim(Customer))+LTrim(RTrim(INVOICE)) As CUSTINV,Cast(If(Count(Invoice) > 1,1,0) as Bit) As AGE_CASH From V_AR_Open_Items Where Batch_Code In ('11','12') And Date_Transaction <= '{0}' Group By Customer,Invoice Order By Invoice;",V.Local.dAgingDate.PervasiveDate,V.Local.sSQL)
	F.Data.Dictionary.CreateFromSQL("dAge3","con",V.Local.sSQL)
	F.Data.Dictionary.SetDefaultReturn("dAge3",False)
	F.Data.DataTable.FillFromDictionary("dtAging0","dAge3","CUSTINV","AGE_CASH3")

	'F.Intrinsic.String.Build("Select LTrim(RTrim(Customer))+LTrim(RTrim(Invoice)) As CUSTINV,Customer,Invoice,Date_Invoice,Cast(If(Count(Invoice) > 1,1,0) as Bit) As AGE_CASH From V_AR_Open_Items Where Batch_Code In ('10','11') And Date_Transaction <= '{0}' Group By Customer,Invoice,Date_Invoice Order By Invoice;",V.Local.dAgingDate.PervasiveDate,V.Local.sSQL)
'	F.Data.DataTable.CreateFromSQL("dtAge","con",V.Local.sSQL,True)
'	F.Data.DataTable.Select("dtAge","AGE_CASH = True",V.Local.sSelect)
'	F.Intrinsic.Control.If(V.Local.sSelect,<>,"***NORETURN***")
'		F.Intrinsic.String.Split(V.Local.sSelect,"*!*",V.Local.sSelect)
'		F.Intrinsic.Control.For(V.Local.iCnt,0,V.Local.sSelect.UBound,1)
'			F.Intrinsic.String.Replace(V.DataTable.dtAge(V.Local.sSelect(V.Local.iCnt)).Customer!FieldValTrim,"'","''",V.Local.sCustomer)
'			F.Intrinsic.String.Replace(V.DataTable.dtAge(V.Local.sSelect(V.Local.iCnt)).Invoice!FieldValTrim,"'","''",V.Local.sInvoice)
'			F.Intrinsic.String.Build("Select Distinct Batch_Code From V_AR_Open_Items Where Customer = '{0}' And Invoice = '{1}' And Date_Invoice = '{2}';",v.Local.sCustomer,v.Local.sInvoice,V.DataTable.dtAge(V.Local.sSelect(V.Local.iCnt)).Date_Invoice!FieldValPervasiveDate,V.Local.sSQL)
'			F.Data.DataTable.CreateFromSQL("dtBatch","con",V.Local.sSQL,True)
'			F.Intrinsic.Control.If(V.DataTable.dtBatch.RowCount,<=,1)
'				F.Data.DataTable.SetValue("dtAge",V.Local.iCnt,"AGE_CASH",False)
'			F.Intrinsic.Control.EndIf
'			F.Data.DataTable.Close("dtBatch")
'		F.Intrinsic.Control.Next(V.Local.iCnt)
'	F.Intrinsic.Control.EndIf
'	F.Data.Dictionary.CreateFromDataTable("dAge","dtAge","CUSTINV","AGE_CASH")
'	F.Data.Dictionary.SetDefaultReturn("dAge",False)
'	F.Data.DataTable.FillFromDictionary("dtAging0","dAge","CUSTINV","AGE_CASH")

	'Set Sales Order
	F.Data.Dictionary.CreateFromSQL("dSO","con","Select LTrim(RTrim(INVOICE)) As Invoice,Order_No+'-'+Left(Order_Line,3) As SO From Order_Hist_Line;")
	F.Data.Dictionary.SetDefaultReturn("dSO","")
	F.Data.DataTable.FillFromDictionary("dtAging0","dSO","INVOICE","SALES_ORDER")

	'Set Email
	F.Data.Dictionary.CreateFromSQL("dEmail","con","Select RTrim(Customer) As Customer,RTrim(Email) As Email from V_Customer_Sales Where Email <> '';")
	F.Data.Dictionary.SetDefaultReturn("dEmail","")
	F.Data.DataTable.FillFromDictionary("dtAging0","dEmail","CUSTOMER","EMAIL")

	'Set Telephone
	F.Data.Dictionary.CreateFromSQL("dTele","con","Select RTrim(Customer) As Customer,Case When Length(LTrim(Telephone)) = 13 Then Left(LTrim(Telephone),6)+' '+Substring(LTrim(Telephone),7,6) When Length(LTrim(Telephone)) = 11 Then Left(LTrim(Telephone),5)+'-'+Substring(LTrim(Telephone),6,6) Else Telephone End As Telephone From V_Customer_Master Where Telephone <> '' Order by Customer;")
	F.Data.Dictionary.SetDefaultReturn("dTele","")
	F.Data.DataTable.FillFromDictionary("dtAging0","dTele","CUSTOMER","TELEPHONE")

	'Set DataView Filter
	F.Intrinsic.Control.If(V.Screen.FrmAging!chkShowZero.Value,=,0)
		V.Local.sFilter.Set("ZERO <> 0")
	F.Intrinsic.Control.ElseIf(V.Screen.FrmAging!chkShowZero.Value,=,1)
		V.Local.sFilter.Set("")
	F.Intrinsic.Control.EndIf

	F.Data.DataView.Create("dtAging0","dvAging0",22,V.Local.sFilter,"")
	F.Data.DataView.ToDataTable("dtAging0","dvAging0","dtAging",True)

	F.Intrinsic.Control.CallSub(LoadGvAging)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadDTAge.End

Program.Sub.LoadGvAging.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.i1.Declare
	V.Local.sCaption.Declare

	Gui.FrmAging.GSGCAging.AddGridviewFromDataTable("gvAging","dtAging")
	Gui.FrmAging.GSGCAging.SuspendLayout()
	Gui.FrmAging.GSGCAging.SetGridViewProperty("gvAging","MultiSelect",True)
	Gui.FrmAging.GSGCAging.SetGridViewProperty("gvAging","OptionBehaviorEditable",True)
	Gui.FrmAging.GSGCAging.SetGridViewProperty("gvAging","AllowSort",True)
	Gui.FrmAging.GSGCAging.SetGridViewProperty("gvAging","AllowFilter",True)
	Gui.FrmAging.GSGCAging.SetGridViewProperty("gvAging","OptionsDetailShowDetailTabs",False)
	Gui.FrmAging.GSGCAging.SetGridViewProperty("gvAging","OptionsViewShowGroupPanel",True)
	Gui.FrmAging.GSGCAging.SetGridViewProperty("gvAging","OptionsViewColumnAutoWidth",False)

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ZERO","Visible",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AGE_CASH","Visible",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AGE_CASH2","Visible",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AGE_CASH3","Visible",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTINV","Visible",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","COLUMN1","Visible",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","Visible",False)

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","ShowCaption",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","ShowCaption",False)

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTOMER","Caption","Cust. No.")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NAME_CUSTOMER","Caption","Customer Name")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","BRANCH","Caption","Branch")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","INVOICE","Caption","Invoice")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_INVOICE","Caption","Invoice Date")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_TRANSACTION","Caption","Transction Date")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DUE_DATE","Caption","Due Date")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TYPE","Caption","Type")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","REFERENCE","Caption","Reference")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_CURR","Caption","Currency")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_AMT","Caption","Amount Forex")
	F.Intrinsic.String.Build("Amount ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AMT_INVOICE","Caption",V.Local.sCaption)
'	F.Intrinsic.String.Build("Current ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
'	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","Caption",V.Local.sCaption)
	F.Intrinsic.Control.If(V.Screen.FrmAging!optAgeDueDate.Value)
		F.Intrinsic.String.Build("<=30 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("31-60 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("61-90 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("91-120 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("121-150 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("151-180 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("181-210 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("211-240 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("241-270 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("271-300 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("301-330 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("331-360 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","Caption",V.Local.sCaption)
		F.Intrinsic.String.Build("> 360 ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","Caption",V.Local.sCaption)
	F.Intrinsic.Control.Else
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","Caption",V.Global.sCaption2)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","Caption",V.Global.sCaption3)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","Caption",V.Global.sCaption4)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","Caption",V.Global.sCaption5)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","Caption",V.Global.sCaption6)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","Caption",V.Global.sCaption7)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","Caption",V.Global.sCaption8)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","Caption",V.Global.sCaption9)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","Caption",V.Global.sCaption10)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","Caption",V.Global.sCaption11)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","Caption",V.Global.sCaption12)
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","Caption",V.Global.sCaption13)		
		Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","Caption",V.Global.sCaptionOver)
	F.Intrinsic.Control.EndIf
	F.Intrinsic.String.Build("Not Aged ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","Caption",V.Local.sCaption)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","COLUMN1","Caption","Column")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","Caption","Adjust")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","Caption","Cash Receipt")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","SALES_ORDER","Caption","Sales Order")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EMAIL","Caption","Email")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TELEPHONE","Caption","Telephone")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTOMER","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NAME_CUSTOMER","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","BRANCH","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","INVOICE","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_INVOICE","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_TRANSACTION","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DUE_DATE","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TYPE","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","REFERENCE","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AMT_INVOICE","AllowEdit",False)
'	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","COLUMN1","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","SALES_ORDER","AllowEdit",False)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EMAIL","AllowEdit",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TELEPHONE","AllowEdit",True)

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EMAIL","ReadOnly",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TELEPHONE","ReadOnly",True)

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTOMER","MinWidth","65")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NAME_CUSTOMER","MinWidth","180")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","BRANCH","MinWidth","65")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","INVOICE","MinWidth","80")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_INVOICE","MinWidth","85")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_TRANSACTION","MinWidth","100")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DUE_DATE","MinWidth","85")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TYPE","MinWidth","75")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","REFERENCE","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_CURR","MinWidth","50")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_AMT","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AMT_INVOICE","MinWidth","95")
'	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","MinWidth","95")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","MinWidth","105")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","COLUMN1","MinWidth","65")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","MinWidth","45")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","MinWidth","85")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","SALES_ORDER","MinWidth","80")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EMAIL","MinWidth","165")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TELEPHONE","MinWidth","120")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTOMER","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NAME_CUSTOMER","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","BRANCH","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","INVOICE","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_INVOICE","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_TRANSACTION","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DUE_DATE","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TYPE","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","REFERENCE","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_CURR","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_AMT","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AMT_INVOICE","HeaderFontBold",True)
'	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","COLUMN1","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","SALES_ORDER","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EMAIL","HeaderFontBold",True)
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TELEPHONE","HeaderFontBold",True)

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTOMER","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NAME_CUSTOMER","HeaderHAlignment","Near")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","INVOICE","HeaderHAlignment","Near")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_INVOICE","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_TRANSACTION","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DUE_DATE","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TYPE","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","REFERENCE","HeaderHAlignment","Near")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_CURR","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_AMT","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AMT_INVOICE","HeaderHAlignment","Far")
'	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","COLUMN1","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","SALES_ORDER","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EMAIL","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TELEPHONE","HeaderHAlignment","Center")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTOMER","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NAME_CUSTOMER","CellHAlignment","Near")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","INVOICE","CellHAlignment","Near")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_INVOICE","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_TRANSACTION","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DUE_DATE","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TYPE","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","REFERENCE","CellHAlignment","Near")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_CURR","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_AMT","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AMT_INVOICE","CellHAlignment","Far")
'	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","CellHAlignment","Far")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","COLUMN1","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","SALES_ORDER","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EMAIL","CellHAlignment","Center")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TELEPHONE","CellHAlignment","Center")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","EXCHANGE_AMT","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","AMT_INVOICE","DisplayCustomNumeric","#,###,###,##0.00")
'	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CURRENT1","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","DisplayCustomNumeric","#,###,###,##0.00")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","DisplayCustomNumeric","#,###,###,##0.00")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_INVOICE","DisplayCustomDatetime","d")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DATE_TRANSACTION","DisplayCustomDatetime","d")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","DUE_DATE","DisplayCustomDatetime","d")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD2","HeaderBackColor","LightBlue")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD3","HeaderBackColor","Aqua")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD4","HeaderBackColor","Plum")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD5","HeaderBackColor","LightGreen")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD6","HeaderBackColor","Lime")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD7","HeaderBackColor","LightYellow")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD8","HeaderBackColor","Yellow")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD9","HeaderBackColor","Orange")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD10","HeaderBackColor","BurlyWood")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD11","HeaderBackColor","LightPink")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD12","HeaderBackColor","LightSalmon")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","TPD13","HeaderBackColor","Salmon")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","OVER","HeaderBackColor","Tomato")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NOT_AGED","HeaderBackColor","LightSteelBlue")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","CUSTOMER","CellBackColor","White")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","NAME_CUSTOMER","CellBackColor","White")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","CellBackColor","Gray")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","CellBackColor","Gray")

	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","ADJUST","CellForeColor","White")
	Gui.FrmAging.GSGCAging.SetColumnProperty("gvAging","PAY","CellForeColor","White")

	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","AMT_INVOICE","AMT_INVOICE","Sum","","","n")
'	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","CURRENT1","CURRENT1","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD2","TPD2","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD3","TPD3","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD4","TPD4","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD5","TPD5","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD6","TPD6","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD7","TPD7","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD8","TPD8","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD9","TPD9","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD10","TPD10","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD11","TPD11","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD12","TPD12","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","TPD13","TPD13","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","OVER","OVER","Sum","","","n")
	Gui.FrmAging.GSGCAging.AddSummaryItem("gvAging","NOT_AGED","NOT_AGED","Sum","","","n")

	F.Intrinsic.Control.For(V.Local.i1,0,V.DataTable.dtAging.RowCount--,1)
		F.Intrinsic.Control.If(V.DataTable.dtAging(V.Local.i1).EXCHANGE_CURR!FieldValTrim,=,V.Company.CurrencySymbol)
			Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",10,V.Local.i1,"BackColor","Gray")
			Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",10,V.Local.i1,"ForeColor","Gray")
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.i1)

	F.Intrinsic.Control.If(V.Screen.FrmAging!optAgeDueDate.Value)
		F.Intrinsic.Control.CallSub(ARAgingByDueDate)
	F.Intrinsic.Control.Else
		F.Intrinsic.Control.CallSub(ARAgingByInvoice)
	F.Intrinsic.Control.EndIf

	Gui.FrmAging.GSGCAging.ResumeLayout()
	Gui.FrmAging.GSGCAging.MainView("gvAging")

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadGvAging.End

Program.Sub.GSGCAging_RowCellClick.Start
	F.Intrinsic.Control.Try
	f.Intrinsic.Control.BlockEvents
	V.Local.sError.Declare

	V.Local.iRet.Declare
	V.Local.sType.Declare
	V.Local.sInvoice.Declare
	v.Local.sQuery.Declare

	f.Intrinsic.Control.BlockEvents
	F.Intrinsic.Control.If(V.Screen.FrmAging!optEdit.Value)
		F.Intrinsic.Control.SelectCase(V.Args.Column)
			F.Intrinsic.Control.Case("ADJUST")				
				f.Global.General.LaunchMenuTask(93,2,V.Local.iRet)				
			F.Intrinsic.Control.Case("PAY")				            	        
				Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","TYPE",V.Args.RowIndex,V.Local.sType)
				F.Intrinsic.Control.If(V.Local.sType,=,"Invoice")
					F.Global.General.LaunchMenuTask(93,2,V.Local.iRet)
				F.Intrinsic.Control.EndIf

			F.Intrinsic.Control.Case("INVOICE")
				f.Intrinsic.Control.If(v.Global.bPrintInvoice)				
					Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","TYPE",V.Args.RowIndex,V.Local.sType)
					Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","Invoice",V.Args.RowIndex,V.Local.sInvoice)
					F.Intrinsic.Control.SelectCase(V.Local.sType)
						F.Intrinsic.Control.CaseAny("Invoice","Cash")
							Function.Intrinsic.String.Build("select count(1) from V_ORDER_HIST_LINE where invoice='{0}'",v.Local.sInvoice,v.Local.sQuery)
							f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sQuery,v.Local.iRet)

							Function.Intrinsic.Control.If(v.Local.iRet,>,0)
								F.Global.General.CallWrapperASync(200700,V.Local.sInvoice)
							Function.Intrinsic.Control.Else
								Function.Intrinsic.UI.Msgbox("The invoice could not be printed.")
							Function.Intrinsic.Control.EndIf
						Function.Intrinsic.Control.Case("Credit Memo")
							Function.Intrinsic.String.Build("select count(1) from V_ORDER_HIST_LINE where invoice='{0}'",v.Local.sInvoice,v.Local.sQuery)
							f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sQuery,v.Local.iRet)

							Function.Intrinsic.Control.If(v.Local.iRet,>,0)
								F.Global.General.CallWrapperASync(200905,V.Local.sInvoice)
							Function.Intrinsic.Control.Else
								Function.Intrinsic.UI.Msgbox("The invoice could not be printed.")
							Function.Intrinsic.Control.EndIf
					F.Intrinsic.Control.EndSelect
				f.Intrinsic.Control.EndIf				
		F.Intrinsic.Control.EndSelect
	F.Intrinsic.Control.Else
		F.Intrinsic.Control.SelectCase(V.Args.column)
			F.Intrinsic.Control.Case("INVOICE")		
				f.Intrinsic.Control.If(v.Global.bPrintInvoice)
					Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","TYPE",V.Args.RowIndex,V.Local.sType)
					Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","Invoice",V.Args.RowIndex,V.Local.sInvoice)
					F.Intrinsic.Control.SelectCase(V.Local.sType)
						F.Intrinsic.Control.CaseAny("Invoice","Cash")
							Function.Intrinsic.String.Build("select count(1) from V_ORDER_HIST_LINE where invoice='{0}'",v.Local.sInvoice,v.Local.sQuery)
							f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sQuery,v.Local.iRet)

							Function.Intrinsic.Control.If(v.Local.iRet,>,0)
								F.Global.General.CallWrapperASync(200700,V.Local.sInvoice)
							Function.Intrinsic.Control.Else
								Function.Intrinsic.UI.Msgbox("The invoice could not be printed.")
							Function.Intrinsic.Control.EndIf
						Function.Intrinsic.Control.Case("Credit Memo")
							Function.Intrinsic.String.Build("select count(1) from V_ORDER_HIST_LINE where invoice='{0}'",v.Local.sInvoice,v.Local.sQuery)
							f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sQuery,v.Local.iRet)

							Function.Intrinsic.Control.If(v.Local.iRet,>,0)
								F.Global.General.CallWrapperASync(200905,V.Local.sInvoice)
							Function.Intrinsic.Control.Else
								Function.Intrinsic.UI.Msgbox("The invoice could not be printed.")
							Function.Intrinsic.Control.EndIf
					F.Intrinsic.Control.EndSelect
				f.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndSelect
	F.Intrinsic.Control.EndIf

	f.Intrinsic.Control.UnBlockEvents
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.Finally
		f.Intrinsic.Control.UnblockEvents
	F.Intrinsic.Control.EndTry
Program.Sub.GSGCAging_RowCellClick.End

Program.Sub.ARAgingByDueDate.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iCnt.Declare
	V.Local.fMons.Declare
	V.Local.dDateInit.Declare
	V.Local.dDatePres.Declare
	V.Local.iDeter.Declare
	V.Local.sType.Declare
	V.Local.bAgeCash.Declare
	V.Local.bAgeCash2.Declare
	V.Local.bAgeCash3.Declare

	Gui.FrmAging.lblStatus.Caption("Aging AR....")
	Gui.FrmAging.pbStatus.Min(0)
	F.Intrinsic.Control.If(V.DataTable.dtAging.RowCount,=,0)
		Gui.FrmAging.pbStatus.Max(100)
		Gui.FrmAging.pbStatus.Value(100)
	F.Intrinsic.Control.Else
		Gui.FrmAging.pbStatus.Max(V.DataTable.dtAging.RowCount)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtAging.RowCount--,1)
		Gui.FrmAging.pbStatus.Value(V.Local.iCnt)
		Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AMT_INVOICE",V.Local.iCnt,V.Local.fMons)
		Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","TYPE",V.Local.iCnt,V.Local.sType)
		Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","DUE_DATE",V.Local.iCnt,V.Local.dDateInit)

		V.local.dDatePres.Set(V.Screen.FrmAging!dtpAgeDate.Value)
		F.Intrinsic.Date.DateDiff("D",V.Local.dDateInit,V.Local.dDatePres,V.Local.iDeter)
		F.Intrinsic.Control.SelectCase(V.Local.sType)
			F.Intrinsic.Control.CaseAny("Invoice","Adjustment","Credit Memo","Discount")
				f.Intrinsic.Control.If(v.Global.bPrintInvoice)
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",3,V.Local.iCnt,"ForeColor","Blue")
				f.Intrinsic.Control.EndIf				
				Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"ForeColor","White")
				Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"BackColor","Gray")
				Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"Halignment","Center")
				Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","PAY",V.Local.iCnt,"Cash Receipt")
'				F.Intrinsic.Control.If(V.Local.iDeter,<,1)
'					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","CURRENT1",V.Local.iCnt,V.Local.fMons)
'					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
'				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,1)
'				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,30)
				F.Intrinsic.Control.If(V.Local.iDeter,<=,30)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD2",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightBlue")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,31)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,60)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD3",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,2)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Aqua")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,61)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,90)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD4",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,3)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Plum")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,91)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,120)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD5",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,4)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightGreen")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,121)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,150)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD6",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,5)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Lime")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,151)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,180)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD7",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,6)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightYellow")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,181)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,210)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD8",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,7)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Yellow")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,211)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,240)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD9",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,8)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Orange")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,241)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,270)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD10",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,9)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","BurlyWood")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,271)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,300)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD11",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,10)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightPink")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,301)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,330)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD12",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,11)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightSalmon")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,331)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,360)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD13",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,12)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Salmon")					
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,361)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","OVER",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,13)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Tomato")
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.CaseAny("Cash","Fin. Charge","Exchange Variance")
				Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AGE_CASH",V.Local.iCnt,V.Local.bAgeCash)
				Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AGE_CASH2",V.Local.iCnt,V.Local.bAgeCash2)
				Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AGE_CASH3",V.Local.iCnt,V.Local.bAgeCash3)
				F.Intrinsic.Control.If(V.Local.bAgeCash,=,True,OR,V.Local.bAgeCash2,=,True,V.Local.bAgeCash3,=,True)
					f.Intrinsic.Control.If(v.Global.bPrintInvoice)
						Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",3,V.Local.iCnt,"ForeColor","Blue")
					f.Intrinsic.Control.EndIf					
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"ForeColor","White")
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"BackColor","Gray")
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"Halignment","Center")
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","PAY",V.Local.iCnt,"Cash Receipt")
'					F.Intrinsic.Control.If(V.Local.iDeter,<,1)
'						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","CURRENT1",V.Local.iCnt,V.Local.fMons)
'						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
'					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,1)
'					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,30)
					F.Intrinsic.Control.If(V.Local.iDeter,<=,30)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD2",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightBlue")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,31)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,60)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD3",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,2)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Aqua")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,61)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,90)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD4",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,3)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Plum")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,91)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,120)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD5",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,4)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightGreen")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,121)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,150)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD6",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,5)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Lime")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,151)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,180)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD7",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,6)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightYellow")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,181)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,210)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD8",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,7)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Yellow")						
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,211)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,240)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD9",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,8)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Orange")						
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,241)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,270)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD10",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,9)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","BurlyWood")						
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,271)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,300)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD11",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,10)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightPink")						
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,301)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,330)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD12",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,11)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightSalmon")					
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,331)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,360)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD13",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,12)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Salmon")						
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>=,361)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","OVER",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,13)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Tomato")
					F.Intrinsic.Control.EndIf
				F.Intrinsic.Control.Else
					f.Intrinsic.Control.If(v.Global.bPrintInvoice)
						Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",3,V.Local.iCnt,"ForeColor","Blue")
					f.Intrinsic.Control.EndIf					
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","NOT_AGED",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,5)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightSteelBlue")
				F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndSelect	
	F.Intrinsic.Control.Next(V.Local.iCnt)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.ARAgingByDueDate.End

Program.Sub.ARAgingByInvoice.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iCnt.Declare
	V.Local.fMons.Declare
	V.Local.dDateInit.Declare
	V.Local.dDatePres.Declare
	V.Local.iDeter.Declare
	V.Local.sType.Declare
	V.Local.bAgeCash.Declare
	V.Local.bAgeCash2.Declare
	V.Local.bAgeCash3.Declare

	Gui.FrmAging.lblStatus.Caption("Aging AR....")
	Gui.FrmAging.pbStatus.Min(0)
	F.Intrinsic.Control.If(V.DataTable.dtAging.RowCount,=,0)
		Gui.FrmAging.pbStatus.Max(100)
		Gui.FrmAging.pbStatus.Value(100)
	F.Intrinsic.Control.Else
		Gui.FrmAging.pbStatus.Max(V.DataTable.dtAging.RowCount)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtAging.RowCount--,1)
		Gui.FrmAging.pbStatus.Value(V.Local.iCnt)
		Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AMT_INVOICE",V.Local.iCnt,V.Local.fMons)
		Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","TYPE",V.Local.iCnt,V.Local.sType)
		Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","DATE_INVOICE",V.Local.iCnt,V.Local.dDateInit)
		V.local.dDatePres.Set(V.Screen.FrmAging!dtpAgeDate.Value)
		F.Intrinsic.Date.DateDiff("D",V.Local.dDateInit,V.Local.dDatePres,V.Local.iDeter)
		F.Intrinsic.Control.SelectCase(V.Local.sType)
			F.Intrinsic.Control.CaseAny("Invoice","Adjustment","Credit Memo","Discount")
				f.Intrinsic.Control.If(v.Global.bPrintInvoice)
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",3,V.Local.iCnt,"ForeColor","Blue")
				f.Intrinsic.Control.EndIf				
				Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"ForeColor","White")
				Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"BackColor","Gray")
				Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"Halignment","Center")
				Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","PAY",V.Local.iCnt,"Cash Receipt")
'				F.Intrinsic.Control.If(V.Local.iDeter,<=,v.Global.iCurEnd)
'					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","CURRENT1",V.Local.iCnt,V.Local.fMons)
'					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
'				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iCurEnd)
'				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd2End)
				F.Intrinsic.Control.If(V.Local.iDeter,<=,v.Global.iPd2End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD2",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightBlue")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd2End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd3End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD3",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,2)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Aqua")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd3End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd4End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD4",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,3)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Plum")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd4End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd5End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD5",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,4)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightGreen")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd5End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd6End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD6",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,5)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Lime")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd6End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd7End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD7",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,6)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightYellow")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd7End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd8End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD8",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,7)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Yellow")
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd8End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd9End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD9",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,8)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Orange")					
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd9End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd10End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD10",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,9)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","BurlyWood")					
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd10End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd11End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD11",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,10)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightPink")					
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd11End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd12End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD12",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,11)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightSalmon")					
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd12End)
				F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd13End)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD13",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,12)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Salmon")							
				F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iOverStart)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","OVER",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,13)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Tomato")
				F.Intrinsic.Control.EndIf

			F.Intrinsic.Control.CaseAny("Cash","Fin. Charge","Exchange Variance")
				Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AGE_CASH",V.Local.iCnt,V.Local.bAgeCash)
				Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AGE_CASH2",V.Local.iCnt,V.Local.bAgeCash2)
				Gui.FrmAging.GSGCAging.GetCellValueByColumnName("gvAging","AGE_CASH3",V.Local.iCnt,V.Local.bAgeCash3)
				F.Intrinsic.Control.If(V.Local.bAgeCash,=,True,OR,V.Local.bAgeCash2,=,True)
					f.Intrinsic.Control.If(v.Global.bPrintInvoice)
						Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",3,V.Local.iCnt,"ForeColor","Blue")
					f.Intrinsic.Control.EndIf					
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"ForeColor","White")
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"BackColor","Gray")
					Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",26,V.Local.iCnt,"Halignment","Center")
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","PAY",V.Local.iCnt,"Cash Receipt")
'					F.Intrinsic.Control.If(V.Local.iDeter,<=,v.Global.iCurEnd)
'						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","CURRENT1",V.Local.iCnt,V.Local.fMons)
'						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
'					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iCurEnd)
'					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd2End)
					F.Intrinsic.Control.If(V.Local.iDeter,<=,v.Global.iPd2End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD2",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,1)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightBlue")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd2End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd3End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD3",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,2)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Aqua")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd3End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd4End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD4",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,3)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Plum")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd4End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd5End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD5",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,4)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightGreen")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd5End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd6End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD6",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,5)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Lime")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd6End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd7End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD7",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,6)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightYellow")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd7End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd8End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD8",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,7)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Yellow")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd8End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd9End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD9",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,8)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Orange")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd9End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd10End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD10",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,9)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","BurlyWood")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd10End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd11End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD11",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,10)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightPink")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd11End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd12End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD12",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,11)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightSalmon")
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iPd12End)
					F.Intrinsic.Control.AndIf(V.Local.iDeter,<=,v.Global.iPd13End)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","TPD13",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,12)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Salmon")						
					F.Intrinsic.Control.ElseIf(V.Local.iDeter,>,v.Global.iOverStart)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","OVER",V.Local.iCnt,V.Local.fMons)
						Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,13)
						Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","Tomato")
					F.Intrinsic.Control.EndIf

				F.Intrinsic.Control.Else
					f.Intrinsic.Control.If(v.Global.bPrintInvoice)
						Gui.FrmAging.GSGCAging.SetCellAppearance("gvAging",2,V.Local.iCnt,"ForeColor","Blue")
					f.Intrinsic.Control.EndIf

					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","NOT_AGED",V.Local.iCnt,V.Local.fMons)
					Gui.FrmAging.GSGCAging.SetCellValueByColumnName("gvAging","COLUMN1",V.Local.iCnt,5)
					Gui.FrmAging.GSGCAging.SetRowAppearance("gvAging",V.Local.iCnt,"BackColor","LightSteelBlue")
				F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndSelect	
	F.Intrinsic.Control.Next(V.Local.iCnt)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.ARAgingByInvoice.End

Program.Sub.LoadDtOverdue.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare

	Gui.FrmAging.lblStatus.Caption("Loading Overdue Invoices....")

	F.Intrinsic.Control.If(V.DataTable.dtOverdue.Exists)
		F.Data.DataTable.Close("dtOverdue")
		F.Data.Dictionary.Close("dSODue")
	F.Intrinsic.Control.EndIf

	v.Local.sSQL.Set("Select distinct RTrim(A.Customer) As Customer,RTrim(B.Name_Customer) As Name_Customer,RTrim(A.Invoice) As Invoice,A.Due_Date,A.EXCHANGE_CURR AS Exchange_Curr, (Select Sum(exchange_amt) From V_AR_Open_Items Where Customer = A.Customer And Invoice = A.Invoice) As Exchange_Amt, (Select Sum(Amt_Invoice) From V_AR_Open_Items Where Customer = A.Customer And Invoice = A.Invoice) As Amt_Invoice,Convert(0,SQL_INTEGER) AS Days_Late,'' as note_1,'Print' As Print_Invoice,'Print' As Print_Statement,'View' As Open_Item_Notes,'Email' As Email_Invoice From V_AR_Open_Items A Left Join V_Customer_Master B On A.Customer = B.Customer Where A.Due_Date < CurDate() And Due_Date <> '1900-1-1' And Amt_Invoice > 0 And Batch_Code <> 12 Order By Invoice;")

	F.Data.DataTable.CreateFromSQL("dtOverdue","con",v.Local.sSQL,True)
	F.Data.DataTable.AddColumn("dtOverdue","SALES_ORDER",String,"")
	F.Data.DataTable.AddColumn("dtOverdue","EMAIL",String,"")
	F.Data.DataTable.AddColumn("dtOverdue","TELEPHONE",String,"")

	'Set Sales Order
	F.Data.Dictionary.CreateFromSQL("dSODue","con","Select Invoice,Order_No+'-'+Left(Order_Line,3) As SO From Order_Hist_Line;")
	F.Data.Dictionary.SetDefaultReturn("dSODue","")
	F.Data.DataTable.FillFromDictionary("dtOverdue","dSODue","INVOICE","SALES_ORDER")

	'Set Email
	F.Data.DataTable.FillFromDictionary("dtOverdue","dEmail","CUSTOMER","EMAIL")

	'Set Telephone
	F.Data.DataTable.FillFromDictionary("dtOverdue","dTele","CUSTOMER","TELEPHONE")

	'Set Notes
	F.Data.Dictionary.CreateFromSQL("dNotes","con","Select RTrim(Invoice) As Invoice,Note_1 From GAB_4437_OVDUE_INVC Order By Invoice;")
	F.Data.Dictionary.SetDefaultReturn("dNotes","")
	F.Data.DataTable.FillFromDictionary("dtOverdue","dNotes","Invoice","Note_1")
	F.Data.Dictionary.Close("dNotes")

	F.Intrinsic.Control.CallSub(LoadGvOverdue)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadDtOverdue.End

Program.Sub.LoadGvOverdue.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.bExists.Declare
	V.Local.iCnt.Declare
	V.Local.dDate.Declare
	V.Local.iDays.Declare
	V.Local.sFilter.Declare
	V.Local.sCaption.Declare

	Gui.FrmAging.GSGCOverdue.AddGridViewFromDataTable("gvOverdue","dtOverdue")
	Gui.FrmAging.GSGCOverdue.SuspendLayout()
	Gui.FrmAging.GSGCOverdue.SetGridViewProperty("gvOverdue","OptionsViewShowGroupPanel",True)
	Gui.FrmAging.GSGCOverdue.SetGridViewProperty("gvOverdue","MultiSelect",False)
	Gui.FrmAging.GSGCOverdue.SetGridViewProperty("gvOverdue","OptionsMenuShowAutoFilterRowItem",False)
	Gui.FrmAging.GSGCOverdue.SetGridViewProperty("gvOverdue","OptionsViewColumnAutoWidth",False)

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Customer","Caption","Customer")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","name_customer","Caption","Customer Name")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Invoice","Caption","Invoice")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","due_date","Caption","Due Date")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Curr","Caption","Currency")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Amt","Caption","Invoice Balance Forex")
	F.Intrinsic.String.Build("Invoice Balance ({0})",V.Company.CurrencySymbol,V.Local.sCaption)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","amt_invoice","Caption",V.Local.sCaption)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","Caption","Days Late")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","Caption","Invoice Notes")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","Caption","Print Invoice")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","Caption","Print Statement")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","Caption","Open Item Notes")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","Caption","Email Invoice")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","SALES_ORDER","Caption","Sales Order")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","Caption","Email")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","Caption","Telephone")

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Invoice","MinWidth","80")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","amt_invoice","MinWidth","175")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","due_date","MinWidth","80")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Curr","MinWidth","50")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Amt","MinWidth","175")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","MinWidth","100")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","MinWidth","100")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Customer","MinWidth","100")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","MinWidth","150")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","MinWidth","100")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","MinWidth","100")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","name_customer","MinWidth","120")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","MinWidth","100")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","SALES_ORDER","MinWidth","80")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","MinWidth","165")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","MinWidth","120")

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Invoice","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","amt_invoice","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Curr","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Amt","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","due_date","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","AllowEdit",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","name_customer","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Customer","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","SALES_ORDER","AllowEdit",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","AllowEdit",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","AllowEdit",True)

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","ReadOnly",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","ReadOnly",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","ReadOnly",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","ReadOnly",True)

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","AllowSort",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","AllowSort",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","AllowSort",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","AllowSort",False)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","AllowSort",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","SALES_ORDER","AllowSort",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","AllowSort",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","AllowSort",True)

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Invoice","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","amt_invoice","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","due_date","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Curr","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Amt","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Customer","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","amt_invoice","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","name_customer","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","SALES_ORDER","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","HeaderFontBold",True)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","HeaderFontBold",True)

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Invoice","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","amt_invoice","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","due_date","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Curr","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Amt","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Customer","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","SALES_ORDER","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","HeaderHAlignment","Center")

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Invoice","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","due_date","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Curr","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","CellHAlignment","Left")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Customer","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Days_Late","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","SALES_ORDER","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","EMAIL","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","TELEPHONE","CellHAlignment","Center")

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Exchange_Amt","DisplayCustomNumeric","###,###,##0.00")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","amt_invoice","DisplayCustomNumeric","###,###,##0.00")

	'Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","CUSTOMER","CellForeColor","Blue")

	f.Intrinsic.Control.If(v.Global.bCustomerStatements)
		Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","CellBackColor","Gray")
		Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Statement","CellForeColor","White")
	f.Intrinsic.Control.EndIf

	f.Intrinsic.Control.If(v.Global.bPrintInvoice)
		Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","CellBackColor","Gray")
		Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Print_Invoice","CellForeColor","White")
	f.Intrinsic.Control.EndIf

	f.Intrinsic.Control.If(v.Global.bAROpen)
		Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","CellBackColor","Gray")
		Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Open_Item_Notes","CellForeColor","White")
	f.Intrinsic.Control.EndIf

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","note_1","CellBackColor","LightYellow")

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","due_date","DisplayCustomDatetime","d")

	Gui.FrmAging.GSGCOverdue.AddSummaryItem("gvOverdue","amt_invoice","amt_invoice","Sum","","","n")

	f.Intrinsic.Control.If(v.Global.bEinvoicing)
		F.ODBC.Connection!con.TableExists("PPT_EINV_COPT",V.Local.bExists)
		f.Intrinsic.Control.If(v.Local.bExists)
			v.Global.sInvoiceMode.Set("S")
		f.Intrinsic.Control.Else
			F.ODBC.Connection!con.TableExists("ATG_CUSTOMER_EMAIL",V.Local.bExists)
			f.Intrinsic.Control.If(v.Local.bExists)
				v.Global.sInvoiceMode.Set("C")
			f.Intrinsic.Control.Else
				v.Global.sInvoiceMode.Set("N")
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf

		F.Intrinsic.Control.If(v.Global.sInvoiceMode,=,"N")
			Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","Visible",false)		
		F.Intrinsic.Control.Else			
			Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","CellBackColor","Gray")
			Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","CellForeColor","White")			
		F.Intrinsic.Control.EndIf
	f.Intrinsic.Control.EndIf	

	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","CellHAlignment","Center")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","MaxWidth","100")
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","AllowEdit",false)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","AllowSort",false)
	Gui.FrmAging.GSGCOverdue.SetColumnProperty("gvOverdue","Email_Invoice","AllowFilter",false)

	'Calculate the days late
	F.Intrinsic.Control.For(v.Local.iCnt,0,V.DataTable.dtOverdue.RowCount--,1)
		Gui.FrmAging.GSGCOverdue.GetCellValueByColumnName("gvOverdue","due_date",v.Local.iCnt,v.Local.dDate)
		V.Local.dDate1900.Declare(Date,"1/1/1900")
		F.Intrinsic.Control.If(v.Local.dDate,<>,v.Local.dDate1900)
			F.Intrinsic.Date.WorkdaysBetweenDates(v.Local.dDate,v.Ambient.Date,127,v.Local.iDays)
			Gui.FrmAging.GSGCOverdue.SetCellValueByColumnName("gvOverdue","Days_Late",v.Local.iCnt,v.Local.iDays)	
		F.Intrinsic.Control.Else
			F.Intrinsic.Date.WorkdaysBetweenDates(v.Local.dDate,v.Ambient.Date,127,v.Local.iDays)
			Gui.FrmAging.GSGCOverdue.SetCellValueByColumnName("gvOverdue","Days_Late",v.Local.iCnt,v.Ambient.dbnull)	
			Gui.FrmAging.GSGCOverdue.SetCellValueByColumnName("gvOverdue","due_date",v.Local.iCnt,v.Ambient.dbnull)	
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(v.Local.iCnt)

	Gui.FrmAging.GSGCOverdue.ResumeLayout()
	Gui.FrmAging.GSGCOverdue.MainView("gvOverdue")

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.LoadGvOverdue.End

Program.Sub.GSGCOverdue_RowCellClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sPar.Declare
	V.Local.sPar2.Declare
	V.Local.sInV.Declare
	V.Local.sCust.Declare
	v.Local.sProgram.Declare(String)
	v.Local.iPID.Declare(long)
	v.Local.iRet.Declare(long)
	v.Local.sQuery.Declare
	v.Local.bExists.Declare(boolean)

	f.Intrinsic.Control.BlockEvents
    Gui.FrmAging.GSGCOverdue.GetCellValueByColumnName("gvOverdue","Customer",V.Args.RowIndex,V.local.sCust)
    Gui.FrmAging.GSGCOverdue.GetCellValueByColumnName("gvOverdue","invoice",V.Args.RowIndex,V.Local.sInv)

    F.Intrinsic.Control.If(V.Args.Column,=,"Print_Invoice")
    	f.Intrinsic.Control.If(v.Global.bPrintInvoice)
	    	Function.Intrinsic.String.Build("select count(1) from V_ORDER_HIST_LINE where invoice='{0}'",v.Local.sInv,v.Local.sQuery)
			f.ODBC.Connection!con.ExecuteAndReturn(v.Local.sQuery,v.Local.iRet)

			Function.Intrinsic.Control.If(v.Local.iRet,>,0)
				Gui.FrmAging..Enabled(false)
		        F.Global.General.CallWrapperSync(200700,V.Local.sInv)
		        Gui.FrmAging..Enabled(true)
			Function.Intrinsic.Control.Else
				Function.Intrinsic.UI.Msgbox("The invoice could not be printed.")
			Function.Intrinsic.Control.EndIf
    	f.Intrinsic.Control.EndIf    	

    F.Intrinsic.Control.ElseIf(V.Args.Column,=,"Print_Statement")
    	f.Intrinsic.Control.If(v.Global.bCustomerStatements)
	    	F.Intrinsic.String.Build("{0}!*!{1}!*!{2}!*!Y!*!N!*!Y!*!{3}!*!!*!!*!N!*!N",V.Local.sCust,V.Local.sCust,V.Ambient.Date.FormatYYYYMMDD,V.Ambient.Date.FormatMMDDYY,v.Local.sPar)
	        F.Global.General.CallWrapperSync(3050,V.Local.sPar)
    	f.Intrinsic.Control.EndIf        

	F.Intrinsic.Control.ElseIf(V.Args.Column,=,"Open_Item_Notes")
		f.Intrinsic.Control.If(v.Global.bAROpen)
			Gui.FrmAging..Enabled(false)
			F.Global.General.CallWrapperSync(100200,V.Local.sCust)
			Gui.FrmAging..Enabled(true)
		f.Intrinsic.Control.EndIf		

	F.Intrinsic.Control.ElseIf(V.Args.Column,=,"Email_Invoice")
		f.Intrinsic.Control.If(v.Global.bEinvoicing)
			f.Intrinsic.Control.If(v.Global.sInvoiceMode,=,"S")
				'Call standard eInvoice to email the invoice

				f.Intrinsic.String.Build("{0}\{1}",v.Caller.GasDir,"PPT_Einvoicing.g2u",v.Local.sProgram)
				Function.Global.General.SetPassedDataElement("DSHInvoice",v.Local.sInV.Trim)
				f.Global.General.CallAsyncGAS(v.Local.sProgram,v.Local.iPID)

			f.Intrinsic.Control.ElseIf(v.Global.sInvoiceMode,=,"C")
				F.ODBC.Connection!conA.TableExists("ATG_CUSTOMER_EMAIL",V.Local.bExists)'Check custom e-invoice
				f.Intrinsic.Control.If(v.Local.bExists)
					'Custom eInvoice process 
					F.Intrinsic.Control.CallSub(einvoicing)
				f.Intrinsic.Control.EndIf
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf		
	F.Intrinsic.Control.EndIf

	f.Intrinsic.Control.UnBlockEvents
	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GSGCOverdue_RowCellClick.End

Program.Sub.GSGCOverdue_CellValueChanged.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sInV.Declare
	V.Local.sDate.Declare
	V.Local.sUser.Declare
	V.Local.sSQL.Declare
	V.Local.sText.Declare

	Gui.FrmAging.GSGCOverdue.GetCellValueByColumnName("gvOverdue","invoice",V.Args.RowIndex,V.Local.sInv)
	F.Intrinsic.String.DateString(V.Ambient.Now,V.Local.sDate)
	V.Local.sUser.Set(V.Caller.User)
	F.Intrinsic.String.Replace(V.Args.Value,"'","''",V.Local.sText)
	F.Intrinsic.String.Build("SELECT * FROM GAB_4437_OVDUE_INVC WHERE RTRIM(INVOICE) = '{0}'",V.Local.sInv.RTrim,V.Local.sSQL)
	F.ODBC.Connection!con.OpenLocalRecordsetRW("rstInvNotes",V.Local.sSQL)
	F.Intrinsic.Control.If(V.ODBC.con!rstInvNotes.EOF)
		F.Intrinsic.String.Build("INSERT INTO GAB_4437_OVDUE_INVC(INVOICE,NOTE_1,CHANGE_DATE,CHANGE_USER) VALUES('{0}','{1}','{2}','{3}')",V.Local.sInv.RTrim,V.Local.sText,V.Local.sDate,V.Local.sUser,V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Build("UPDATE GAB_4437_OVDUE_INVC SET NOTE_1 = '{0}',CHANGE_DATE = '{2}',CHANGE_USER = '{3}' WHERE RTRIM(INVOICE) = '{1}';",V.Local.sText,V.Local.sInv.RTrim,V.Local.sDate,V.Local.sUser,V.Local.sSQL)
		F.ODBC.Connection!con.Execute(V.Local.sSQL)
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rstInvNotes.Close

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GSGCOverdue_CellValueChanged.End

Program.Sub.Charts1.Start
	V.Local.fCurrent.Declare
	V.Local.fTPD2.Declare
	V.Local.fTPD3.Declare
	V.Local.fTPD4.Declare
	V.Local.fTPD5.Declare
	V.Local.fTPD6.Declare
	V.Local.fTPD7.Declare
	V.Local.fTPD8.Declare
	V.Local.fTPD9.Declare
	V.Local.fTPD10.Declare
	V.Local.fTPD11.Declare
	V.Local.fTPD12.Declare
	V.Local.fTPD13.Declare
	V.Local.fOver.Declare
	V.Local.sSeries.Declare

	Gui.FrmAging.gsChartAging.ClearChart

	F.Data.DataTable.Compute("dtAging","SUM(CURRENT1)","",v.Local.fCurrent)
	f.Data.DataTable.Compute("dtAging","SUM(TPD2)","",v.Local.fTPD2)
	F.Data.DataTable.Compute("dtAging","SUM(TPD3)","",v.Local.fTPD3)
	F.Data.DataTable.Compute("dtAging","SUM(TPD4)","",v.Local.fTPD4)
	F.Data.DataTable.Compute("dtAging","SUM(TPD5)","",v.Local.fTPD5)
	F.Data.DataTable.Compute("dtAging","SUM(TPD6)","",v.Local.fTPD6)
	F.Data.DataTable.Compute("dtAging","SUM(TPD7)","",v.Local.fTPD7)
	F.Data.DataTable.Compute("dtAging","SUM(TPD8)","",v.Local.fTPD8)
	F.Data.DataTable.Compute("dtAging","SUM(TPD9)","",v.Local.fTPD9)
	F.Data.DataTable.Compute("dtAging","SUM(TPD10)","",v.Local.fTPD10)
	F.Data.DataTable.Compute("dtAging","SUM(TPD11)","",v.Local.fTPD11)
	F.Data.DataTable.Compute("dtAging","SUM(TPD12)","",v.Local.fTPD12)
	F.Data.DataTable.Compute("dtAging","SUM(TPD13)","",v.Local.fTPD13)
	F.Data.DataTable.Compute("dtAging","SUM(OVER)","",v.Local.fOver)

	F.Intrinsic.Control.If(V.Screen.FrmAging!optAgeDueDate.Value)
'		F.Intrinsic.String.Build("<1*!*{0}*!*1-30*!*{1}*!*31-60*!*{2}*!*Over 60*!*{3}",v.Local.fCurrent,V.Local.fTPD2,V.Local.fTPD3,v.Local.fOver,v.Local.sSeries)
		F.Intrinsic.String.Build("<=30*!*{1}*!*31-60*!*{2}*!*31-60*!*{2}*!*61-90*!*{3}*!*91-120*!*{4}*!*121-150*!*{5}*!*151-180*!*{6}*!*181-210*!*{7}*!*211-240*!*{8}*!*241-270*!*{9}*!*271-300*!*{10}*!*301-330*!*{11}*!*331-360*!*{12}*!*Over 360*!*{13}",v.Local.fCurrent,V.Local.fTPD2,V.Local.fTPD3,V.Local.fTPD4,V.Local.fTPD5,V.Local.fTPD6,V.Local.fTPD7,V.Local.fTPD8,V.Local.fTPD9,V.Local.fTPD10,V.Local.fTPD11,V.Local.fTPD12,V.Local.fTPD13,v.Local.fOver,v.Local.sSeries)
	f.Intrinsic.Control.Else
		F.Intrinsic.String.Build("0-{0}*!*{1}*!*{2}*!*{3}*!*{4}*!*{5}*!*{6}*!*{7}*!*{8}*!*{9}*!*{10}*!*{11}*!*{12}*!*{13}*!*{14}*!*{15}*!*{16}*!*{17}*!*{18}*!*{19}*!*{20}*!*{21}*!*{22}*!*{23}*!*{24}*!*{25}*!*{26}*!*{27}",v.Global.iCurEnd,v.Local.fCurrent,v.Global.sCaption2,V.Local.fTPD2,v.Global.sCaption3,V.Local.fTPD3,v.Global.sCaption4,V.Local.fTPD4,v.Global.sCaption5,V.Local.fTPD5,v.Global.sCaption6,V.Local.fTPD6,v.Global.sCaption7,V.Local.fTPD7,v.Global.sCaption8,V.Local.fTPD8,v.Global.sCaption9,V.Local.fTPD9,v.Global.sCaption10,V.Local.fTPD10,v.Global.sCaption11,V.Local.fTPD11,v.Global.sCaption12,V.Local.fTPD12,v.Global.sCaption13,V.Local.fTPD13,v.Global.sCaptionOver,v.Local.fOver,v.Local.sSeries)
	F.Intrinsic.Control.EndIf

	Gui.FrmAging.gsChartAging.CreateFunnelChart("AR Aging",v.Local.sSeries,0,2,3,2,False,False)
Program.Sub.Charts1.End

Program.Sub.Charts2.Start
	V.Local.iCnt.Declare
	V.Local.iCnt2.Declare
	V.Local.sCustomer.Declare
	V.Local.sFilter.Declare
	V.Local.sSeries.Declare
	V.Local.fAmount.Declare
	V.Local.iVendors.Declare

	F.Data.DataView.Create("dtAging","dvAging")
	F.Data.DataView.ToDataTableDistinct("dtAging","dvAging","dtCust","NAME_CUSTOMER")
	F.Data.DataTable.AddColumn("dtCust","SUM",Float)

	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtCust.RowCount--,1)
		F.Intrinsic.String.Replace(V.DataTable.dtCust(V.Local.iCnt).NAME_CUSTOMER!FieldVal,"'","''",V.Local.sCustomer)
		F.Intrinsic.String.Build("NAME_CUSTOMER = '{0}'",V.Local.sCustomer,V.Local.sFilter)
		F.Data.DataTable.Compute("dtAging","SUM(AMT_INVOICE)",V.Local.sFilter,V.Local.fAmount)
		F.Data.DataTable.SetValue("dtCust",V.Local.iCnt,"SUM",V.Local.fAmount)
	F.Intrinsic.Control.Next(v.Local.iCnt)

	F.Data.DataView.Create("dtCust","dvCust",22,"","SUM DESC")
	F.Data.DataView.ToDataTable("dtCust","dvCust","dtFunnel")

	F.Intrinsic.Control.If(V.DataTable.dtFunnel.RowCount,<=,10)
		V.Local.iVendors.Set(V.DataTable.dtFunnel.RowCount--)
	F.Intrinsic.Control.Else
		V.Local.iVendors.Set(9)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.For(V.Local.iCnt,0,v.Local.iVendors,1)
		F.Intrinsic.Control.If(V.Local.iCnt2,=,0)
			F.Intrinsic.Control.If(V.DataTable.dtFunnel(V.Local.iCnt).NAME_CUSTOMER!FieldValTrim,<>,"")
				F.Intrinsic.String.Build("{0}*!*{1}",V.DataTable.dtFunnel(V.Local.iCnt).NAME_CUSTOMER!FieldVal,V.DataTable.dtFunnel(V.Local.iCnt).SUM!FieldVal,V.Local.sSeries)
				V.Local.iCnt2.Set(1)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Else
			F.Intrinsic.Control.If(V.DataTable.dtFunnel(V.Local.iCnt).NAME_CUSTOMER!FieldValTrim,<>,"")
				F.Intrinsic.String.Build("{0}*!*{1}*!*{2}",v.Local.sSeries,v.DataTable.dtFunnel(v.Local.iCnt).NAME_CUSTOMER!FieldVal,v.DataTable.dtFunnel(v.Local.iCNt).SUM!FieldVal,v.Local.sSeries)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(v.Local.iCnt)

	Gui.FrmAging.gsChartTopTen.ClearChart
	Gui.FrmAging.gsChartTopTen.CreateFunnelChart("Top Ten Customers",v.local.sSeries,0,2,3,2,False,False)
Program.Sub.Charts2.End

Program.Sub.Charts3.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	v.Local.sSQL.Declare(string)
	v.Local.sAryName.Declare(string)
	v.Local.sAryVal.Declare(string)
	v.Local.sArray.Declare(string)
	v.Local.dDate1.Declare(date)
	v.Local.dDate2.Declare(date)
	v.Local.i.Declare(long)
	v.Local.iDay.Declare(long)
	v.Local.iDay2.Declare(long)
	v.Local.Cur.Declare(string)
	v.Local.sPd2.Declare(string)
	v.Local.sPd3.Declare(string)
	v.Local.sPd4.Declare(string)
	v.Local.sOverRpt.Declare(string)

	Gui.FrmAging.lblStatus.Caption("Loading Chart 3 of 3....")

'	Function.Intrinsic.Control.If(v.Global.fCurRpt,<,0)
'		v.Local.Cur.Set(0)
'	Function.Intrinsic.Control.Else
'		v.Local.Cur.Set(v.Global.fCurRpt)
'	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd2Rpt,<,0)
		v.Local.sPd2.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd2.Set(v.Global.fPd2Rpt)
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd3Rpt,<,0)
		v.Local.sPd3.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd3.Set(v.Global.fPd3Rpt)
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd4Rpt,<,0)
		v.Local.sPd4.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd4.Set(v.Global.fPd4Rpt)
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd5Rpt,<,0)
		v.Local.sPd5.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd5.Set(v.Global.fPd5Rpt)
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd6Rpt,<,0)
		v.Local.sPd6.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd6.Set(v.Global.fPd6Rpt)
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd7Rpt,<,0)
		v.Local.sPd7.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd7.Set(v.Global.fPd7Rpt)		
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd8Rpt,<,0)
		v.Local.sPd8.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd8.Set(v.Global.fPd7Rpt)		
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd9Rpt,<,0)
		v.Local.sPd9.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd9.Set(v.Global.fPd7Rpt)		
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd10Rpt,<,0)
		v.Local.sPd10.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd10.Set(v.Global.fPd7Rpt)		
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd11Rpt,<,0)
		v.Local.sPd11.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd11.Set(v.Global.fPd7Rpt)		
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd12Rpt,<,0)
		v.Local.sPd12.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd12.Set(v.Global.fPd7Rpt)		
	Function.Intrinsic.Control.EndIf
	Function.Intrinsic.Control.If(v.Global.fPd13Rpt,<,0)
		v.Local.sPd13.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sPd13.Set(v.Global.fPd7Rpt)		
	Function.Intrinsic.Control.EndIf	
	Function.Intrinsic.Control.If(v.Global.fOverRpt,<,0)
		v.Local.sOverRpt.Set(0)
	Function.Intrinsic.Control.Else
		v.Local.sOverRpt.Set(v.Global.fOverRpt)
	Function.Intrinsic.Control.EndIf

	'Build Arrays
	F.Intrinsic.String.Build("{0}*!*{1}*!*{2}*!*{3}*!*{4}",v.Local.Cur,v.Local.sPd2,v.Local.sPd3,v.Local.sPd4,v.Local.sOverRpt,v.Local.sAryVal)
'	F.Intrinsic.String.Build("0-{0}*!*|30|-{1}*!*|60|-{2}*!*|91|-{3}*!*|121|+",v.Global.iCurEndRpt,v.Global.iPd2EndRpt,v.Global.iPd3EndRpt,v.Global.iOverStartRpt,v.Local.sAryName)
'	F.Intrinsic.String.Build("0-{0}*!*|30|-{1}*!*|60|-{2}*!*|90|-{3}*!*|120|-{4}*!*|150|-{5}*!*|180|-{6}*!*|211|+",v.Global.iCurEndRpt,v.Global.iPd2EndRpt,v.Global.iPd3EndRpt,v.Global.iPd4EndRpt,v.Global.iPd5EndRpt,v.Global.iPd6EndRpt,v.Global.iOverStartRpt,v.Local.sAryName)
	F.Intrinsic.String.Build("0-{1}*!*|60|-{2}*!*|90|-{3}*!*|120|-{4}*!*|150|-{5}*!*|180|-{6}*!*|211|+",v.Global.iCurEndRpt,v.Global.iPd2EndRpt,v.Global.iPd3EndRpt,v.Global.iPd4EndRpt,v.Global.iPd5EndRpt,v.Global.iPd6EndRpt,v.Global.iOverStartRpt,v.Local.sAryName)
'	Function.Intrinsic.Math.Add(v.Global.iCurEndRpt,1,v.Local.i)
'	Function.Intrinsic.String.Replace(v.Local.sAryName,"|30|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd2EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|60|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd3EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|90|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd4EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|120|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd5EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|150|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd6EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|180|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd7EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|210|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd8EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|240|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd9EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|270|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd10EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|300|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd11EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|330|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iPd12EndRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|360|",v.Local.i,v.Local.sAryName)
	Function.Intrinsic.Math.Add(v.Global.iOverStartRpt,1,v.Local.i)
	Function.Intrinsic.String.Replace(v.Local.sAryName,"|361|",v.Local.i,v.Local.sAryName)

	F.Intrinsic.String.Build("{0}!*!{1}",v.Local.sAryName,v.Local.sAryVal,v.Local.sArray)

	'Create Pie Chart
	'Gui.FrmAging.ChartAging.ClearChart
	'Gui.FrmAging.ChartAging.CreatePieChart("Aging","C3",v.Local.sArray)
	'Gui.FrmAging.ChartAging.SetChartProperty("LEGEND","","Visible",-1,False)

	'Gui.frmAgingChart.ChartAging2.ClearChart
	'Gui.frmAgingChart.ChartAging2.CreatePieChart("Aging","C3",v.Local.sArray)
	'Gui.frmAgingChart.ChartAging2.SetChartProperty("LEGEND","","Visible",-1,False)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry	
Program.Sub.Charts3.End

Program.Sub.EmailInvoice.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sQuery.Declare(String)
	V.Local.sContacts.Declare(String)
	V.Local.sContacts.Redim(-1,-1)
	V.Local.sDelete.Declare(String)
	V.Local.sDelete.Redim(-1,-1)
	V.Local.iUB.Declare(Long,-1)
	V.Local.bExists.Declare(Boolean)
	V.Local.iC.Declare(Long)
	V.Local.iEmailSalesRep.Declare(Long,-1)
	V.Local.sEmail.Declare(String)
	V.local.sTemp.Declare(String)
	V.Local.iUserID.Declare
	V.Local.sUserName.Declare(String)
	V.Local.sUserEmail.Declare(String)
	V.Local.iRecord.Declare(Long,-1)
	V.Local.sInvoicePath.Declare(String)
	V.Local.sBody.Declare(String)
	V.Local.sSubject.Declare(String)
	V.Local.sFile.Declare(String)
	V.Local.bFileExists.Declare(Boolean)
	V.Local.iType.Declare(Long)

	F.Intrinsic.Control.CallSub(setcontacts)
	F.Intrinsic.Control.CallSub(checkcontacts)
	v.Local.iType.Set(v.Args.iType)

	F.Global.Security.GetUserID(V.Caller.User,V.Caller.CompanyCode,V.Local.iUserID)

	'Get all customer contacts and build array
	F.Intrinsic.Control.If(v.Local.iType,=,0)
		F.Intrinsic.String.Build("SELECT EMAIL1, NAME FROM CONTACT WHERE TYPE = 'C' AND CUST = '{0}'",v.Global.sCust,v.Local.sQuery)
		f.ODBC.Connection!con.OpenRecordsetRO("rstCust",v.Local.sQuery)
		F.Intrinsic.Control.DoUntil(v.ODBC.con!rstCust.EOF,=,true)
			F.Intrinsic.Math.Add(v.Local.iUB,1,v.Local.iUB)
			F.Intrinsic.Control.If(v.Local.iUB,=,0)
				v.Local.sContacts.Redim(0,0)
			F.Intrinsic.Control.Else
				v.Local.sContacts.RedimPreserve(0,v.Local.iUB)
			F.Intrinsic.Control.EndIf
			F.Intrinsic.String.Concat(v.ODBC.con!rstCust.FieldValTrim!EMAIL1,"*!*",v.ODBC.con!rstCust.FieldValTrim!NAME,v.Local.sTemp)
			v.Local.sContacts(v.Local.iUB).Set(v.Local.sTemp)
			f.ODBC.con!rstCust.MoveNext
		F.Intrinsic.Control.Loop
		f.ODBC.con!rstCust.Close
	F.Intrinsic.Control.EndIf

	Gui.frmEInvoice.progressBar1.Value(30)

	v.Local.iUB.Set(-1)
	F.Intrinsic.String.Build("SELECT * FROM ATG_CUSTOMER_EMAIL WHERE CUSTOMER='{0}'",v.Global.sCust,v.Local.sQuery)
	f.ODBC.Connection!con.OpenRecordsetRW("rstCust",v.Local.sQuery)
	F.Intrinsic.Control.DoUntil(v.ODBC.con!rstCust.EOF,=,true)
		F.Intrinsic.Control.If(v.Local.iEmailSalesRep,=,-1)
			'generate invoice PDF
			F.Intrinsic.String.Build("SELECT ORDER_NO FROM ORDER_HIST_HEAD WHERE INVOICE = '{0}'",v.Global.sInv,v.Local.sQuery)
			f.ODBC.Connection!con.OpenRecordsetRO("rstOrder",v.Local.sQuery)
			F.Intrinsic.Control.If(v.ODBC.con!rstOrder.EOF,=,false)
				v.Global.sOrderNo.Set(v.ODBC.con!rstorder.FieldValTrim!ORDER_NO)
					'get email body text
					F.Intrinsic.Control.CallSub(emailbody)
					v.Local.sBody.Set(v.Args.sBody)
					v.Local.sSubject.Set(v.Args.sSubject)
					F.Intrinsic.Control.CallSub(processinv)
					v.Local.sInvoicePath.Set(v.Args.sAttach)
				F.Intrinsic.Control.Else
					F.Intrinsic.UI.Msgbox("Unable to find order number.  Please contact Global Shop.","e-Invoicing")
				F.Intrinsic.Control.EndIf
				f.ODBC.con!rstOrder.Close

				Gui.frmEInvoice.progressBar1.Value(50)

				F.Intrinsic.Control.If(v.ODBC.con!rstCust.FieldValTrim!SALES_EMAIL,=,true)
					v.Local.iEmailSalesRep.Set(1)
					F.Intrinsic.String.Build("SELECT S.SALESPERSON AS EMAIL, N.SALESPERSON FROM SALESPEOPLE S, CUSTOMER_MASTER C, V_SALESPEOPLE N WHERE N.SALESPERSON_CODE=S.SALESPERSON_CODE AND C.SALESPERSON=S.SALESPERSON_CODE AND C.CUSTOMER = '{0}' AND S.KEY1='AR2' AND S.KEY2='SLM'",v.Global.sCust,v.Local.sQuery)
					f.ODBC.Connection!con.OpenRecordsetRO("rstSalesPerson",v.Local.sQuery)
					F.Intrinsic.Control.If(v.ODBC.con!rstSalesperson.EOF,=,false)
						F.Intrinsic.Debug.SetLA("Emailing Sales Rep: ",v.ODBC.con!rstSalesperson.FieldValTrim!SALESPERSON," email: ",v.ODBC.con!rstSalesperson.FieldValTrim!EMAIL)
						F.Intrinsic.Control.If(v.ODBC.con!rstSalesperson.FieldValTrim!EMAIL,<>,"")
'							F.Global.Messaging.CreateEMmessage(to email, to name, sender email, sender name, subject, body, attachment)
'							F.Global.Messaging.CreateEMMessage(v.ODBC.con!rstSalesperson.FieldValTrim!EMAIL,v.ODBC.con!rstSalesperson.FieldValTrim!SALESPERSON,v.ODBC.con!rstSalesperson.FieldValTrim!EMAIL,v.ODBC.con!rstSalesperson.FieldValTrim!SALESPERSON,v.Local.sSubject,v.Local.sBody,v.Local.sInvoicePath,false)
'							F.Global.Messaging.QueueMessage(sCoCode, iUserID, CallingPrgm, Subject, SenderEmail*!*sSenderName, Recipients, Body, Mode, sReplyToAddress, bReadReceipt, sAdditionalHeaders, dateDeferredDelivery, sMeta0, sMeta1, sMeta2, sMeta3, sMeta4, AttachmentFileName*!*AttachmentFilePath, bDeleteAttach)
							F.Intrinsic.String.Build("{0}*!*{1}",v.ODBC.con!rstSalesperson.FieldValTrim!EMAIL,v.ODBC.con!rstSalesperson.FieldValTrim!SALESPERSON,V.Local.sUserEmail)
							F.Intrinsic.String.Build("{0}.pdf*!*{1}\Invoices\",v.Global.sInv,V.Caller.PluginsDir,v.Local.sInvoicePath)
							F.Intrinsic.String.Concat(v.Caller.PluginsDir,"\Invoices\",v.Global.sInv,".pdf",v.Local.sAttach)
							F.Global.Messaging.QueueMessage(V.Caller.CompanyCode,V.Local.iUserID,"",v.Local.sSubject,V.Local.sUserEmail,v.ODBC.con!rstSalesperson.FieldValTrim!EMAIL,v.Local.sBody,"","",False,"",,"","","","","",v.Local.sInvoicePath,False)
						F.Intrinsic.Control.EndIf
					F.Intrinsic.Control.EndIf
				F.Intrinsic.Control.Else
					v.Local.iEmailSalesRep.Set(0)
'					f.ODBC.con!rstSalesperson.Close
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.EndIf

			'check to see if contact in ATG_CUSTOMER_EMAIL is still a contact for customer in CRM.  If not, email will not be sent to that contact
			F.Intrinsic.Control.If(v.Local.iType,=,0)
				v.Local.bExists.Set(false)
					F.Intrinsic.Control.For(v.Local.iC,0,v.Local.sContacts.UBound,1)
						F.Intrinsic.String.Split(v.Local.sContacts(v.Local.iC).Trim,"*!*",v.Local.sTemp)
						F.Intrinsic.Control.If(v.ODBC.con!rstCust.FieldValTrim!CUST_EMAIL,=,v.Local.sTemp(0))
							v.Local.bExists.Set(true)
							F.Intrinsic.Control.ExitFor(v.Local.iC)
						F.Intrinsic.Control.EndIf
					f.Intrinsic.Control.Next(v.Local.iC)
				F.Intrinsic.Control.Else
					v.Local.bExists.Set(true)
					v.Local.sTemp.Redim(0,1)
					v.Local.sTemp(0).Set(v.ODBC.con!rstCust.FieldValTrim!CUST_EMAIL)
					v.Local.sTemp(1).Set(v.ODBC.con!rstCust.FieldValTrim!CUST_EMAIL)
			F.Intrinsic.Control.EndIf

			Gui.frmEInvoice.progressBar1.Value(75)

		F.Intrinsic.Control.If(v.Local.bExists,=,true)
			'email
			F.Global.Security.GetFullName(v.Caller.User,v.Local.sUserName)
			F.Global.Security.GetUserEmail(v.Caller.User,v.Local.sUserEmail)
			F.Intrinsic.Control.If(v.Local.sUserEmail,=,"")
				v.local.sUserName.Set(v.Local.sTemp(1))
				v.Local.sUserEmail.Set(v.Local.sTemp(0))
			F.Intrinsic.Control.Else
				F.Intrinsic.String.Build("{0}*!*{1}",V.Local.sUserEmail,V.Local.sUserName,V.Local.sUserEmail)
			F.Intrinsic.Control.EndIf

			F.Intrinsic.String.Build("{0}.pdf*!*{1}\Invoices\",v.Global.sInv,V.Caller.PluginsDir,v.Local.sInvoicePath)

'			F.Global.Messaging.CreateEMMessage(v.Local.sTemp(0),v.Local.sTemp(1),v.Local.sUserEmail,v.Local.sUserName,v.Local.sSubject,v.Local.sBody,v.Local.sInvoicePath,false)
'			F.Global.Messaging.QueueMessage(sCoCode, iUserID, CallingPrgm, Subject, SenderEmail*!*sSenderName, Recipients, Body, Mode, sReplyToAddress, bReadReceipt, sAdditionalHeaders, dateDeferredDelivery, sMeta0, sMeta1, sMeta2, sMeta3, sMeta4, AttachmentFileName*!*AttachmentFilePath, bDeleteAttach)
			F.Global.Messaging.QueueMessage(V.Caller.CompanyCode,V.Local.iUserID,"",v.Local.sSubject,V.Local.sUserEmail,v.ODBC.con!rstCust.FieldValTrim!CUST_EMAIL,v.Local.sBody,"","",False,"","","","","","","",v.Local.sInvoicePath,False)
			'write record
			F.Intrinsic.Control.If(v.Local.iRecord,=,-1)
				f.Intrinsic.String.Trim(v.Global.sCust,v.Global.sCust)
				f.ODBC.Connection!con.OpenRecordsetRW("rstRecord","SELECT * FROM ATG_CUST_EMAIL_HIST")
				f.ODBC.con!rstRecord.AddNew
				f.ODBC.con!rstRecord.Set!CUSTOMER(v.Global.sCust)
				f.ODBC.con!rstRecord.set!INVOICE_NO(v.Global.sInv)
				f.ODBC.con!rstRecord.Set!EMAIL_DATE(v.Ambient.Now)
				f.ODBC.con!rstRecord.Update
				f.ODBC.con!rstRecord.Close
				v.Local.iRecord.Set(0)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.Else
			F.Intrinsic.Math.Add(v.Local.iUB,1,v.Local.iUB)
			F.Intrinsic.Control.If(v.Local.iUB,=,0)
				v.Local.sDelete.Redim(0,0)
			F.Intrinsic.Control.Else
				v.Local.sDelete.RedimPreserve(0,v.Local.iUB)
			F.Intrinsic.Control.EndIf
			v.Local.sDelete(v.Local.iUB).Set(v.ODBC.con!rstCust.FieldValTrim!CUST_EMAIL)
		F.Intrinsic.Control.EndIf
		f.ODBC.con!rstCust.MoveNext
	F.Intrinsic.Control.Loop
	f.ODBC.con!rstCust.Close
	'f.ODBC.con!rstRecord.Close

	Gui.frmEInvoice.progressBar1.Value(95)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.EmailInvoice.End

Program.Sub.ProcessInv.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sParamName.Declare(String)
	V.Local.sParamVal.Declare(String)
	V.Local.sTemp.Declare(String)
	V.Local.sPN.Declare(String)
	V.Local.sPV.Declare(String)
	V.Local.sCallParams.Declare(String)
	V.Local.sAttach.Declare(String)
	V.Local.sVersion.Declare(String)
	V.Local.iRptID.Declare(Long)
	V.Local.sPath.Declare(String)
	V.Local.bExists.Declare(Boolean)
	V.Local.bReportFound.Declare(Boolean)
	V.Local.sQuery.Declare(String)
	V.Local.sReport.Declare(String)

	F.Intrinsic.String.Concat(v.Caller.PluginsDir,"\Invoices\",v.Global.sInv,".pdf",v.Local.sAttach)
	F.Intrinsic.String.Left(v.Caller.GSSVersion,4,v.Local.sVersion)

	'process BI table
	F.Intrinsic.String.Build("{0}!*!|~|CRYSTAL-OVERRIDE|~|",v.Global.sInv,v.Local.sCallParams)
	F.Intrinsic.Debug.SetLA("Generating Invoice BI data.  Using Callwrapper 200900: ",v.Local.sCallParams)
	F.Global.General.CallWrapperSyncBIO(200900,v.Local.sCallParams)

	'get report id
	F.Intrinsic.String.concat("SELECT * FROM V_PRT_LASER_INVOICE WHERE INVOICE_NO='",V.Global.sInv,"'",V.Local.sQuery)
	F.ODBC.Connection!con.OpenRecordsetRO("rstReport",V.Local.sQuery)
	F.Intrinsic.Control.If(V.ODBC.con!rstReport.EOF,<>,True)
		V.local.iRptID.set(V.ODBC.con!rstReport.fieldvaltrim!RPTID)
	F.Intrinsic.Control.Else
		F.Intrinsic.UI.Msgbox("Unable to find Invoice Data.  Please contact Global Shop.")
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rstReport.Close
	F.Intrinsic.Variable.AddRV("RptID",V.Local.iRptID)

	v.Local.bReportFound.Set(false)
	f.ODBC.Connection!con.TableExists("ATG_EINVOICE_CCC",v.Local.bExists)
	F.Intrinsic.Control.If(v.Local.bExists,=,true)
		F.Intrinsic.String.Concat("SELECT * FROM ATG_EINVOICE_CCC WHERE COMPANY_CODE = '",v.Caller.CompanyCode,"'",v.Local.sQuery)
		f.ODBC.Connection!con.OpenRecordsetRO("rstReport",v.Local.sQuery)
		F.Intrinsic.Control.If(v.ODBC.con!rstReport.EOF,=,false)
			v.Local.bReportFound.Set(true)
			F.Intrinsic.String.Concat("E-INVOICE-",v.Caller.CompanyCode,v.Local.sReport)
			v.Local.sPath.Set(v.ODBC.con!rstReport.FieldValTrim!REPORT_LOC)
			F.Intrinsic.File.Exists(v.Local.sPath,v.Local.bExists)
			F.Intrinsic.Control.If(v.Local.bExists,=,false)
				F.Intrinsic.String.Right(v.Local.sPath,4,v.Local.sTemp)
				F.Intrinsic.Control.If(v.Local.sTemp.UBound,<>,".RPT")
					F.Intrinsic.String.Concat(v.Local.sPath,".rpt",v.Local.sPath)
					F.Intrinsic.File.Exists(v.Local.sPath,v.Local.bExists)
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.If(v.Local.bExists,=,true)
				f.Global.BI.InitializeReport(v.Local.sReport,v.Local.sPath,v.Local.iRptID)
				F.Intrinsic.Control.If(v.Local.iRptID,=,-1)
					F.Intrinsic.String.Concat("Unable to initialize a report for e-Invoicing in the following location setup for company code",v.Caller.CompanyCode," in ATG_EINVOICE_CCC: ", v.Local.sPath,". Please contact Global Shop support.",v.Local.sPath)
					F.Intrinsic.UI.Msgbox(v.Local.sPath,"e-Invoicing")
					F.Intrinsic.UI.Msgbox("Please set up e-Invoicing-CCC.rpt.  Please call Global Shop for more info.")
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	f.ODBC.con!rstReport.Close
	F.Intrinsic.Control.EndIf

	V.Local.sPN.Set("REPORTID*!*TERMINAL*!*ORDERNO*!*PROGRAM*!*TRACK*!*IVCTYPE*!*PRTSHIP*!*PRTORD*!*IVCTYPE*!*PRTSHIP*!*PRTORD*!*INVOICE")
	F.Intrinsic.String.Concat("000055","*!*",V.caller.Terminal,"*!**!**!**!**!**!**!**!**!**!**!**!**!*",V.Local.sPV)

	F.Intrinsic.String.Split(v.Local.sPN,"*!*",v.Local.sParamName)
	F.Intrinsic.String.Split(v.Local.sPV,"*!*",v.Local.sParamVal)
	F.Global.BI.SaveReport(v.Local.iRptID,1,v.Local.sParamName,v.Local.sParamVal,v.Local.sAttach)
	F.Intrinsic.Variable.AddRV("sAttach",v.Local.sAttach)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.ProcessInv.End

Program.Sub.CheckContacts.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	'Checks to see how e-Invoicing contacts were added.  iType=0 if added from ATG_AUTO_EMAIL_CUST.gas from CRM, iType=1 if using script button from Customer Master (ATG_Invoice_Delivery.gas)
	V.Local.sQuery.Declare(String)
	V.Local.iType.Declare(Long)

	V.Local.sQuery.Set("SELECT * FROM ATG_CUSTOMER_EMAIL WHERE CUSTOMER='-1'")
	F.ODBC.Connection!con.OpenRecordsetRO("rstCheck",V.Local.sQuery)
	F.Intrinsic.Control.If(V.ODBC.con!rstCheck.EOF,=,True)
		V.Local.iType.Set(0)
	F.Intrinsic.Control.Else
		V.Local.iType.Set(1)
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rstCheck.Close

	F.Intrinsic.Variable.AddRV("iType",V.Local.iType)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckContacts.End

Program.Sub.EmailBody.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sFile.Declare(String)
	V.Local.sText.Declare(String)
	V.Local.bExists.Declare(Boolean)
	V.Local.sSubject.Declare(String)
	V.Local.sBody.Declare(String)

	F.Intrinsic.String.Concat(V.Caller.PluginsDir,"\GAB\GAS\eInvoicing_Body_Text.txt",V.Local.sFile)
	F.Intrinsic.File.Exists(V.Local.sFile,V.Local.bExists)
	F.Intrinsic.Control.If(V.Local.bExists,=,True)
		F.Intrinsic.File.File2String(V.Local.sFile,V.Local.sBody)
	F.Intrinsic.Control.Else
		V.Local.sBody.Set("Attached is your invoice.  Thank you.")
		F.Intrinsic.String.Concat("e-Invoice ",V.Global.sInv,V.Local.sSubject)
		F.Intrinsic.File.String2File(V.Local.sFile,V.Local.sBody)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.File.File2String(V.Local.sFile,V.Local.sText)
	F.Intrinsic.String.Replace(V.local.sText,"%INVOICE%",V.Global.sInv,V.Local.sText)
	F.Intrinsic.String.Replace(V.Local.sText,"%CUSTPO%",V.Global.sCustPO,V.Local.sText)
	F.Intrinsic.String.Replace(V.Local.sText,"%CUSTOMER%",V.Global.sCustomerName,V.Local.sText)
	F.Intrinsic.String.Replace(V.Local.sText,"%COMPANY%",V.Ambient.CompanyName,V.Local.sText)
	F.Intrinsic.String.Split(V.Local.sText,"*!*",V.Local.sText)

	F.Intrinsic.Control.If(V.Local.sText.UBound,>,0)
		V.Local.sSubject.Set(V.Local.sText(0))
		V.Local.sBody.Set(V.Local.sText(1))
	F.Intrinsic.Control.Else
		V.Local.sBody.Set(V.Local.sText)
		F.Intrinsic.String.Concat("e-Invoice ",V.Global.sInv,V.Local.sSubject)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Variable.AddRV("sBody",V.Local.sBody)
	F.Intrinsic.Variable.AddRV("sSubject",V.Local.sSubject)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.EmailBody.End

Program.Sub.GetCustInfo.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sQuery.Declare(String)

	F.Intrinsic.String.Concat("SELECT CUSTOMER_PO FROM V_ORDER_HEADER WHERE ORDER_NO='",V.Global.sOrderNo,"'",V.Local.sQuery)
	F.ODBC.Connection!con.OpenRecordsetRO("rstCustPO",V.Local.sQuery)
	F.Intrinsic.Control.If(V.ODBC.con!rstCustPO.EOF,<>,True)
		V.Global.sCustPO.Set(V.ODBC.con!rstCustPO.FieldValTrim!CUSTOMER_PO)
	F.Intrinsic.Control.Else
		F.ODBC.con!rstCustPO.Close
		F.Intrinsic.String.LPad(V.Global.sOrderNo,"0",7,V.Local.sQuery)
		F.Intrinsic.String.Concat("SELECT CUSTOMER_PO FROM V_ORDER_HEADER WHERE ORDER_NO='",V.Local.sQuery,"'",V.Local.sQuery)
		F.ODBC.Connection!con.OpenRecordsetRO("rstCustPO",V.Local.sQuery)
		F.Intrinsic.Control.If(V.ODBC.con!rstCustPO.EOF,<>,True)
			V.Global.sCustPO.Set(V.ODBC.con!rstCustPO.FieldValTrim!CUSTOMER_PO)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rstCustPO.Close

	F.Intrinsic.String.Concat("SELECT NAME_CUSTOMER FROM V_CUSTOMER_MASTER WHERE CUSTOMER='",V.Global.sCust,"'",V.Local.sQuery)
	F.ODBC.Connection!con.OpenRecordsetRO("rstCustPO",V.Local.sQuery)
	F.Intrinsic.Control.If(V.ODBC.con!rstCust.EOF,<>,True)
		V.Global.sCustomerName.Set(V.ODBC.con!rstCustPO.FieldValTrim!NAME_CUSTOMER)
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rstCustPO.Close

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GetCustInfo.End

Program.Sub.SetContacts.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	'Sets e-Invoicing contacts method as iType=1 (See Check_eContacts_Meth sub).  iType=0 if added from ATG_AUTO_EMAIL_CUST.gas from CRM, iType=1 if using script button from Customer Master (ATG_Invoice_Delivery.gas)
	V.Local.sQuery.Declare(String)

	V.Local.sQuery.Set("SELECT * FROM ATG_CUSTOMER_EMAIL WHERE CUSTOMER='-1'")
	F.ODBC.Connection!con.OpenRecordsetRW("rstCheck",V.Local.sQuery)
	F.Intrinsic.Control.If(V.ODBC.con!rstCheck.EOF,=,True)
		F.ODBC.con!rstCheck.AddNew
		F.ODBC.con!rstCheck.Set!Customer("-1")
		F.ODBC.con!rstCheck.Set!Cust_email("-1")
		F.ODBC.con!rstCheck.Set!Sales_email(False)
		f.ODBC.con!rstCheck.Update
	F.Intrinsic.Control.EndIf
	F.ODBC.con!rstCheck.Close

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.SetContacts.End

Program.Sub.UpdateATGCustEmail.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	v.Local.sEmail.Declare(string)
	v.Local.sCompany.Declare(string)
	v.Local.sQuery.Declare(string)
	v.Local.sQuery2.Declare(string)
	V.Local.sSQL.Declare(string)
	v.Local.sMessage.Declare(string)

	F.Intrinsic.String.Trim(v.Global.sCust,v.Global.sCust)

	F.Intrinsic.String.Build("SELECT * FROM ATG_CUSTOMER_EMAIL WHERE CUSTOMER = '{0}'",v.Global.sCust,v.Local.sQuery2)
	F.Intrinsic.String.Build("Contacts not set up for customer {0}.  Please set up contacts this customer in CRM.",v.Global.sCust,v.Local.sMessage)

	F.ODBC.Connection!con.OpenLocalRecordsetRW("rstB",v.Local.sQuery2)

	F.Intrinsic.Control.If(v.ODBC.con!rstB.EOF)
		F.Intrinsic.UI.Msgbox(v.Local.sMessage,"Invalid Contacts")
	F.Intrinsic.Control.EndIf

	F.ODBC.con!rstB.Close

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.UpdateATGCustEmail.End

Program.Sub.EInvoicing.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.FrmAging..Enabled(false)
	Gui.frmEInvoice..Visible(true)
	Gui.frmEInvoice.lbl1.Caption("Processing E-Invoice")
	F.Intrinsic.Control.CallSub(updateatgcustemail)
	Gui.frmEInvoice.progressBar1.Value(15)
	F.Intrinsic.Control.CallSub(emailinvoice)
	Gui.frmEInvoice.progressBar1.Value(90)
	Gui.frmEInvoice.progressBar1.Value(100)
	Gui.frmEInvoice..Visible(false)
	Gui.FrmAging..Enabled(true)
	Gui.FrmAging..Show(true)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.EInvoicing.End

Program.Sub.chkShowZero_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.FrmAging.GSGCAging.Visible(False)
	F.Intrinsic.Control.BlockEvents
	F.Intrinsic.Control.CallSub(loaddtage)
	'F.Intrinsic.Control.CallSub(araging)
	F.Intrinsic.Control.UnBlockEvents
	Gui.FrmAging.GSGCAging.Visible(True)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.chkShowZero_Click.End

Program.Sub.chkHideAcc_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.FrmAging.GSGCAging.Visible(False)
	F.Intrinsic.Control.BlockEvents
	F.Intrinsic.Control.CallSub(loaddtage)
	'F.Intrinsic.Control.CallSub(araging)
	F.Intrinsic.Control.UnBlockEvents
	Gui.FrmAging.GSGCAging.Visible(True)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.chkHideAcc_Click.End

Program.Sub.dtpAgeDate_Change.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.FrmAging.cmdRefresh.BackColor(6053069)
	Gui.FrmAging.lblAgingDt.BackColor(6053069)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.dtpAgeDate_Change.End

Program.Sub.picGSSLogo_DblClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Task.ShellExec(0,"Open","http://www.globalshopsolutions.com/login-customer","","",0)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.picGSSLogo_DblClick.End

Program.Sub.Serialize.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSerialize.Declare

	'gvAging
	Gui.FrmAging.GSGCAging.Serialize("gvAging",V.Local.sSerialize)
	F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVAGING",5435,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,V.Local.sSerialize)
	'gvOverdue
	Gui.FrmAging.GSGCOverdue.Serialize("gvOverdue",V.Local.sSerialize)
	F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVOVERDUE",5435,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,V.Local.sSerialize)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End

	F.Intrinsic.Control.EndTry
Program.Sub.Serialize.End

Program.Sub.Deserialize.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSerialize.Declare

	'Delete old registry records
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GVAGING",5435,0,5,"",V.Local.sSerialize)
	F.Intrinsic.Control.If(V.Local.sSerialize.Trim,<>,"")
		F.ODBC.Connection!common.OpenConnection(V.Ambient.Ccon,V.Ambient.Cuser,V.Ambient.Cpass)
		F.ODBC.Connection!common.Execute("Delete From Gs_Registry Where Reg_ID = 5435 And Seq < 1000;")
		F.ODBC.Connection!common.Close
	F.Intrinsic.Control.EndIf

	'gvAging
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GVAGING",5435,1000,6,"",V.Local.sSerialize)
	F.Intrinsic.Control.If(V.Local.sSerialize.Trim,<>,"")
		Gui.FrmAging.GSGCAging.Deserialize(V.Local.sSerialize)
	F.Intrinsic.Control.EndIf
	'gvOverdue
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GVOVERDUE",5435,1000,6,"",V.Local.sSerialize)
	F.Intrinsic.Control.If(V.Local.sSerialize.Trim,<>,"")
		Gui.FrmAging.GSGCOverdue.Deserialize(V.Local.sSerialize)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End

	F.Intrinsic.Control.EndTry
Program.Sub.Deserialize.End

Program.Sub.ddlFilter_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Intrinsic.Control.If(V.Global.bLoadDataStatements)
		F.Intrinsic.Control.CallSub(SerializeStatements)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.If(V.DataTable.dtCustInv.Exists)
		F.Data.DataTable.Close("dtCustInv")
		F.Data.DataTable.Close("dtCustomers")
	F.Intrinsic.Control.EndIf

	'Get Customers and Invoices
	F.Data.DataTable.CreateFromSQL("dtCustInv","con","Select Distinct CUSTOMER,INVOICE,DUE_DATE From V_AR_OPEN_ITEMS Where DUE_DATE <> '1900-01-01' Order By CUSTOMER;",True)

	'Pull Customers
	F.Data.DataTable.CreateFromSQL("dtCustomers","con","Select CUSTOMER,NAME_CUSTOMER From V_CUSTOMER_MASTER Order By CUSTOMER;",True)
	F.Data.DataTable.AddColumn("dtCustomers","BALANCE",Float,0)
	F.Data.DataTable.AddColumn("dtCustomers","OVERDUE",Boolean,False)

	'Check Balances
	F.Intrinsic.Control.CallSub(CheckBalances)

	'Create Statements and Load Main DataTable
	F.Intrinsic.Control.CallSub(CreateStatements)

	V.Global.bLoadDataStatements.Set(True)

	Gui.FrmAging.lblStatus.Visible(False)
	Gui.FrmAging.pbStatus.Visible(False)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.ddlFilter_Click.End

Program.Sub.CheckBalances.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sBalanceRet.Declare
	V.Local.sCustomer.Declare
	V.Local.sInvoice.Declare
	V.Local.sRowRet.Declare
	V.Local.sExp.Declare
	V.Local.sSelect.Declare
	V.Local.fBalance.Declare
	V.Local.iCnt.Declare
	V.Local.bOverdue.Declare

	Gui.FrmAging.lblStatus.Caption("Checking Balances....")
	Gui.FrmAging.lblStatus.Visible(True)
	Gui.FrmAging.pbStatus.Visible(True)

	Gui.FrmAging.pbStatus.Min(0)
	Gui.FrmAging.pbStatus.Max(V.DataTable.dtCustInv.RowCount--)

	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtCustInv.RowCount--,1)
		Gui.FrmAging.pbStatus.Value(V.Local.iCnt)
		V.Local.sCustomer.Set(V.DataTable.dtCustInv(V.Local.iCnt).CUSTOMER!FieldValTrim)
		V.Local.sInvoice.Set(V.DataTable.dtCustInv(V.Local.iCnt).INVOICE!FieldValTrim)
		V.Local.bOverdue.Set(False)
		F.Intrinsic.Control.If(V.DataTable.dtCustInv(V.Local.iCnt).DUE_DATE!FieldVal,<=,V.Ambient.Date)
			V.Local.bOverdue.Set(True)
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.sInvoice,<>,"")
			F.Global.Accounting.GetARItemStatus(V.Local.sCustomer,V.Local.sInvoice,V.Local.sBalanceRet)
			F.Intrinsic.Control.If(V.Local.sBalanceRet.IsNotNoReturn)
				F.Intrinsic.String.Split(V.Local.sBalanceRet,"*!*",V.Local.sBalanceRet)
				F.Intrinsic.Control.If(V.Local.sBalanceRet(2),<>,"")
					F.Intrinsic.String.Build("CUSTOMER = '{0}'",V.Local.sCustomer,V.Local.sExp)
					F.Data.DataTable.Select("dtCustomers",V.Local.sExp,V.Local.sSelect)
					F.Intrinsic.Control.If(V.Local.sSelect.IsNotNoReturn)
						V.Local.fBalance.Set(V.DataTable.dtCustomers(V.Local.sSelect.Long).BALANCE!FieldVal)
						F.Intrinsic.Math.Add(V.Local.fBalance,V.Local.sBalanceRet(2),V.Local.fBalance)
						F.Intrinsic.Control.If(V.Local.fBalance,=,0)
							V.Local.bOverdue.Set(False)
						F.Intrinsic.Control.EndIf
						F.Intrinsic.Control.If(V.DataTable.dtCustomers(V.Local.sSelect.Long).OVERDUE!FieldVal)
							F.Data.DataTable.SetValue("dtCustomers",V.Local.sSelect.Long,"BALANCE",V.Local.fBalance)
						F.Intrinsic.Control.Else
							F.Data.DataTable.SetValue("dtCustomers",V.Local.sSelect.Long,"BALANCE",V.Local.fBalance,"OVERDUE",V.Local.bOverdue)
						F.Intrinsic.Control.EndIf
					F.Intrinsic.Control.EndIf
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.iCnt)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CheckBalances.End

Program.Sub.CreateStatements.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sDir.Declare
	V.Local.bDir.Declare
	V.Local.sCustomer.Declare
	V.Local.sCustomerEmail.Declare
	V.Local.sCustomerName.Declare
	V.Local.sDate.Declare
	V.Local.sDateStamp.Declare
	V.Local.sFilePath.Declare
	V.Local.sLogo.Declare
	V.Local.sParam.Declare
	V.Local.sTitles.Declare
	V.Local.sVal.Declare
	V.Local.iCnt.Declare
	V.Local.iRet.Declare
	V.Local.iBIRunID.Declare
	V.Local.iLogID.Declare
	V.Local.dDateRan.Declare
	V.Local.fBalance.Declare
	V.Local.bOverdue.Declare
	V.Local.sSenderName.Declare
	V.Local.sSenderEmail.Declare
	V.Local.sSubject.Declare
	V.Local.sBody.Declare
	V.Local.dDateSub.Declare
	V.Local.sPDFText.Declare

	Gui.FrmAging.lblStatus.Caption("Generating Statements....")

	'Check for Directory
	F.Intrinsic.String.Build("{0}\Statements",V.Caller.PluginsDir,V.Local.sDir)
	F.Intrinsic.File.DirExists(v.Local.sDir,v.Local.bDir)
	F.Intrinsic.Control.If(v.local.bDir,=,False)
		F.Intrinsic.File.CreateDir(v.Local.sDir)
	F.Intrinsic.Control.Endif

	'Close DataTable
	F.Intrinsic.Control.If(V.DataTable.dtStatements.Exists)
		F.Data.DataTable.Close("dtStatements")
	F.Intrinsic.Control.EndIf

	'Create DataTable
	F.Data.DataTable.Create("dtStatements",True)
	F.Data.DataTable.AddColumn("dtStatements","SEL",Boolean)
	F.Data.DataTable.AddColumn("dtStatements","CUSTOMER",String)
	F.Data.DataTable.AddColumn("dtStatements","CUSTOMERNAME",String)
	F.Data.DataTable.AddColumn("dtStatements","CONTACT",String)
	F.Data.DataTable.AddColumn("dtStatements","EMAIL",String)
	F.Data.DataTable.AddColumn("dtStatements","STATEMENT",String)
	F.Data.DataTable.AddColumn("dtStatements","BALANCE",Float)
	F.Data.DataTable.AddColumn("dtStatements","OVERDUE",Boolean)
	F.Data.DataTable.AddColumn("dtStatements","DATERAN",Date)
	F.Data.DataTable.AddColumn("dtStatements","SENDERNAME",String)
	F.Data.DataTable.AddColumn("dtStatements","SENDEREMAIL",String)
	F.Data.DataTable.AddColumn("dtStatements","SUBJECT",String)
	F.Data.DataTable.AddColumn("dtStatements","BODY",String)

	'Set Variables
	F.Global.BI.GetRunID(V.Local.iBIRunID)
	F.Global.BI.StartLogging(V.Local.iBIRunID,562,0,"",V.Local.iLogID)
	V.Local.dDateRan.Set(V.Screen.FrmAging!dtpStateDate.Value)
	F.Intrinsic.String.Format(V.Ambient.Date,"YYYYMMDD",v.Local.sDateStamp)
	F.Intrinsic.String.Format(V.Local.dDateRan,"MMDDYY",v.Local.sDate)
	V.Local.dDateSub.Set(V.Ambient.Date)

	'Get Titles
	F.ODBC.Connection!con.ExecuteAndReturn("Select TEXT1 From V_OP_HEADER WHERE ID = '401069' OR ID = '401070' OR ID = '401071'",V.Local.sTitles)
	F.Intrinsic.String.Split(V.Local.sTitles,"#$#",V.Local.sTitles)

	Gui.FrmAging.pbStatus.Min(0)
	Gui.FrmAging.pbStatus.Max(V.DataTable.dtCustomers.RowCount--)

	'Print Statement, Save PDF and Populate Main DataTable
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.DataTable.dtCustomers.RowCount--,1)
		Gui.FrmAging.pbStatus.Value(V.Local.iCnt)
		V.Local.sCustomer.Set(V.DataTable.dtCustomers(V.Local.iCnt).CUSTOMER!FieldValTrim)
		V.Local.sCustomerName.Set(V.DataTable.dtCustomers(V.Local.iCnt).NAME_CUSTOMER!FieldValTrim)
		V.Local.fBalance.Set(V.DataTable.dtCustomers(V.Local.iCnt).BALANCE!FieldVal)
		V.Local.bOverdue.Set(V.DataTable.dtCustomers(V.Local.iCnt).OVERDUE!FieldVal)
		F.Intrinsic.String.Build("{0}\{1}_{2}.pdf",V.Local.sDir,V.Local.sDateStamp,V.Local.sCustomer,V.Local.sFilePath)
		'Get Contact
		F.Intrinsic.Control.CallSub(GetContact,"Customer",V.Local.sCustomer)
		'Sender
		F.Global.Security.GetFullName(V.Caller.User,V.Local.sSenderName)
		F.Global.Security.GetUserEmail(V.Caller.User,V.Local.sSenderEmail)
		'Subject
		F.Intrinsic.String.Build("{0}\PPT_AR_Subject.txt",V.Caller.FilesDir,V.Local.sSubject)
		F.Intrinsic.File.File2String(V.Local.sSubject,V.Local.sSubject)
		F.Intrinsic.String.Replace(V.Local.sSubject,"%CUST%",V.Local.sCustomerName,V.Local.sSubject)
		F.Intrinsic.String.Replace(V.Local.sSubject,"%DATE%",V.Local.dDateSub.String,V.Local.sSubject)
		'Body
		F.Intrinsic.String.Build("{0}\PPT_AR_Body.txt",V.Caller.FilesDir,V.Local.sBody)
		f.Intrinsic.File.File2String(V.Local.sBody,V.Local.sBody)
		F.Intrinsic.String.Replace(V.Local.sBody,"%USER%",V.Local.sSenderName,V.Local.sBody)
		'Add new records
		F.Intrinsic.Control.If(V.Local.fBalance,<=,0)
			'Add Record/Row
			F.Data.DataTable.AddRow("dtStatements","SEL",False,"CUSTOMER",V.Local.sCustomer,"CUSTOMERNAME",V.Local.sCustomerName,"CONTACT",V.Local.sCustomerName,"EMAIL",V.Args.Email,"STATEMENT","","BALANCE",V.Local.fBalance,"OVERDUE",V.Local.bOverdue,"DATERAN",V.Local.dDateRan,"SENDERNAME",V.Local.sSenderName,"SENDEREMAIL",V.Local.sSenderEmail,"SUBJECT",V.Local.sSubject,"BODY",V.Local.sBody)
		F.Intrinsic.Control.Else
			'Create statement with CallWrapper
			F.Intrinsic.String.Build("{0}!*!{0}!*!{1}!*!Y!*!N!*!N!*!{3}!*!{2}!*!{2}!*!N!*!N",V.Local.sCustomer,V.local.sDate," ",V.Local.sDate,V.Local.sParam)
			F.Global.General.CallWrapperSyncBIO(3050,V.Local.sParam)
			'Export and save PDF
			V.Local.sParam.Set("Terminal*!*ReportID*!*ATTN*!*Title1*!*Title2*!*Title3*!*Title4*!*Logo")
			F.Intrinsic.String.Build("{0}*!*000562*!*Y*!*{1}*!*{2}*!*{3}*!*{4}*!*{5}",V.Caller.Terminal,"Current",V.Local.sTitles(0),V.Local.sTitles(1),V.Local.sTitles(2),V.local.sLogo.Trim,V.Local.sVal)
			F.Global.BI.RunReportPreProcessor(V.Local.iBIRunID,V.Local.iLogID,V.Local.sParam,V.Local.sVal,"",4,True,"",-1,"",0,V.Local.sFilePath,"",V.Local.iRet)
			'Check PDF Text and make sure the page is not blank
			F.Automation.PDF.Open("STATEMENT",V.Local.sFilePath)
			F.Automation.PDF.TextSearch("STATEMENT",V.Local.sCustomerName,V.Local.sPDFText)
			F.Automation.PDF.Close("STATEMENT")
			F.Intrinsic.Control.If(V.Local.sPDFText.IsNoReturn)
				V.Local.sFilePath.Set("")
			F.Intrinsic.Control.EndIf
			'Add Record/Row
			F.Data.DataTable.AddRow("dtStatements","SEL",True,"CUSTOMER",V.Local.sCustomer,"CUSTOMERNAME",V.Local.sCustomerName,"CONTACT",V.Local.sCustomerName,"EMAIL",V.Args.Email,"STATEMENT",V.Local.sFilePath,"BALANCE",V.Local.fBalance,"OVERDUE",V.Local.bOverdue,"DATERAN",V.Local.dDateRan,"SENDERNAME",V.Local.sSenderName,"SENDEREMAIL",V.Local.sSenderEmail,"SUBJECT",V.Local.sSubject,"BODY",V.Local.sBody)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.iCnt)

	'Stop BI Logging
	F.Global.BI.StopLogging(V.Local.iLogID)

	'Apply DataView Based on Dropdown List Filter
	F.Intrinsic.Control.SelectCase(V.Screen.FrmAging!ddlFilter.ItemData)
		F.Intrinsic.Control.Case(0)
			F.Data.DataView.Create("dtStatements","dvStatements",22,"BALANCE > 0","")

		F.Intrinsic.Control.Case(1)
			F.Data.DataView.Create("dtStatements","dvStatements",22,"BALANCE > 0 AND OVERDUE = True","")

	F.Intrinsic.Control.EndSelect

	'Add Column
	F.Data.DataTable.AddColumn("dtStatements","PREVIEW",String,"Preview")

	'Format Grid
	F.Intrinsic.Control.CallSub(FormatStatements)
	F.Intrinsic.Control.CallSub(DeserializeStatements)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.CreateStatements.End

Program.Sub.GetContact.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSQL.Declare
	V.Local.sContact.Declare
	V.Local.sEmail.Declare
	V.Local.iCnt.Declare

	F.Intrinsic.Control.SelectCase(V.Screen.FrmAging!ddlContact.ItemData)
		F.Intrinsic.Control.Case(0)
			F.Intrinsic.String.Build("Select RTRIM(A.NAME_CUSTOMER) As CONTACT,B.ADDL_EMAILS As EMAIL From V_CUSTOMER_MASTER A Left Join PPT_EINV_COPT B On A.CUSTOMER = B.CUSTOMER_ID WHERE CUSTOMER = '{0}';",V.Args.Customer,V.Local.sSQL)
			F.Data.DataTable.CreateFromSQL("dtContacts","con",v.Local.sSQL,True)
			F.Intrinsic.Control.If(V.DataTable.dtContacts.RowCount,<>,0)
				F.Intrinsic.Variable.AddRV("Contact",V.DataTable.dtContacts(0).CONTACT!FieldVal)
				F.Intrinsic.Variable.AddRV("Email",V.DataTable.dtContacts(0).EMAIL!FieldValTrim)
			F.Intrinsic.Control.Else
				F.Intrinsic.Variable.AddRV("Contact","")
				F.Intrinsic.Variable.AddRV("Email","")
			F.Intrinsic.Control.EndIf
			F.Data.DataTable.Close("dtContacts")

		F.Intrinsic.Control.Case(1)
			F.Intrinsic.String.Build("Select CASE WHEN NAME_PREFERRED <> '' THEN RTRIM(NAME_PREFIX)+' '+RTRIM(NAME_PREFERRED)+' '+RTRIM(NAME_LAST) ELSE RTRIM(NAME_PREFIX)+' '+RTRIM(NAME_LAST)+' '+RTRIM(NAME_LAST) END AS CONTACT,EMAIL1 As EMAIL From CONTACT A Left Join CRM_CONTACT_AUX B On A.ALT_ID = B.CID Where MOD(B.E_PROG_SETTINGS,2) <> 0 And TYPE = 'C' And CUST = '{0}';",V.Args.Customer,V.Local.sSQL)
			F.Data.DataTable.CreateFromSQL("dtContacts","con",v.Local.sSQL,True)
			F.Intrinsic.Control.If(V.DataTable.dtContacts.RowCount,<>,0)
				V.Local.sContact.Set(V.DataTable.dtContacts(0).CONTACT!FieldVal)
				V.Local.sEmail.Set(V.DataTable.dtContacts(0).EMAIL!FieldValTrim)
				F.Intrinsic.Control.For(V.Local.iCnt,1,V.DataTable.dtContacts.RowCount--,1)
					F.Intrinsic.String.Build("{0},{1}",V.Local.sContact,V.DataTable.dtContacts(V.Local.iCnt).CONTACT!FieldVal,V.Local.sContact)
					F.Intrinsic.String.Build("{0},{1}",V.Local.sEmail,V.DataTable.dtContacts(V.Local.iCnt).EMAIL!FieldValTrim,V.Local.sEmail)
				F.Intrinsic.Control.Next(V.Local.iCnt)
				F.Intrinsic.Variable.AddRV("Contact",V.Local.sContact)
				F.Intrinsic.Variable.AddRV("Email",V.Local.sEmail)
			F.Intrinsic.Control.Else
				F.Intrinsic.Variable.AddRV("Contact","")
				F.Intrinsic.Variable.AddRV("Email","")
			F.Intrinsic.Control.EndIf
			F.Data.DataTable.Close("dtContacts")

	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GetContact.End

Program.Sub.FormatStatements.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iCnt.Declare
	V.Local.sColumns.Declare

	'Set and Format Grid
	Gui.FrmAging.GSGCStatements.AddGridviewFromDataview("gvStatements","dtStatements","dvStatements")
	Gui.FrmAging.GSGCStatements.SuspendLayout()
	Gui.FrmAging.GSGCStatements.SetGridViewProperty("gvStatements","MultiSelect",True)
	Gui.FrmAging.GSGCStatements.SetGridViewProperty("gvStatements","AllowSort",True)
	Gui.FrmAging.GSGCStatements.SetGridViewProperty("gvStatements","AllowFilter",True)
	Gui.FrmAging.GSGCStatements.SetGridViewProperty("gvStatements","OptionsDetailShowDetailTabs",False)
	Gui.FrmAging.GSGCStatements.SetGridViewProperty("gvStatements","OptionsViewShowGroupPanel",False)
	Gui.FrmAging.GSGCStatements.SetGridViewProperty("gvStatements","EnableAppearanceOddRow",True)
	Gui.FrmAging.GSGCStatements.SetGridViewProperty("gvStatements","OptionsFindAlwaysVisible",False)

	'Loop through columns names by using the V.DataTable.dtName.FieldNames
	F.Intrinsic.String.Split(V.DataTable.dtStatements.FieldNames,"*!*",V.Local.sColumns)
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.Local.sColumns.UBound,1)
		Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements",V.Local.sColumns(V.Local.iCnt),"HeaderFontBold",True)
	F.Intrinsic.Control.Next(V.Local.iCnt)

	'SEL
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SEL","Caption","Select")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SEL","MinWidth","45")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SEL","AllowEdit",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SEL","ReadOnly",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SEL","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SEL","CellHAlignment","Center")

	'CUSTOMER
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMER","Caption","Cust. No.")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMER","MinWidth","55")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMER","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMER","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMER","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMER","CellHAlignment","Center")

	'CUSTOMERNAME
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMERNAME","Caption","Customer Name")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMERNAME","MinWidth","130")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMERNAME","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMERNAME","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMERNAME","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CUSTOMERNAME","CellHAlignment","Left")

	'CONTACT
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CONTACT","Visible",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CONTACT","Caption","Contact")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CONTACT","MinWidth","105")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CONTACT","AllowEdit",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CONTACT","ReadOnly",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CONTACT","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","CONTACT","CellHAlignment","Left")

	'EMAIL
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","EMAIL","Caption","Email")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","EMAIL","MinWidth","105")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","EMAIL","AllowEdit",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","EMAIL","ReadOnly",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","EMAIL","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","EMAIL","CellHAlignment","Left")

	'STATEMENT
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","STATEMENT","Caption","Statement")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","STATEMENT","MinWidth","125")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","STATEMENT","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","STATEMENT","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","STATEMENT","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","STATEMENT","CellHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","STATEMENT","CellForeColor","Blue")

	'BALANCE
	F.Intrinsic.String.Build("Balance ({0})",V.Company.CurrencySymbol,V.Local.sColumns)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BALANCE","Caption",V.Local.sColumns)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BALANCE","MinWidth","85")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BALANCE","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BALANCE","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BALANCE","HeaderHAlignment","Far")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BALANCE","CellHAlignment","Far")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BALANCE","DisplayCustomNumeric",n2)
	Gui.FrmAging.GSGCStatements.AddSummaryItem("gvStatements","BALANCE","BALANCE","SUM","Total: ","","#,###,###,##0.00")

	'OVERDUE
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","OVERDUE","Caption","Overdue")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","OVERDUE","MinWidth","45")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","OVERDUE","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","OVERDUE","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","OVERDUE","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","OVERDUE","CellHAlignment","Center")

	'DATERAN
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","Visible",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","Caption","Date Ran")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","MinWidth","85")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","CellHAlignment","Center")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","DATERAN","DisplayCustomDatetime","d")

	'SENDERNAME
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDERNAME","Visible",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDERNAME","Caption","Sender Name")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDERNAME","MinWidth","85")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDERNAME","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDERNAME","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDERNAME","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDERNAME","CellHAlignment","Left")

	'SENDEREMAIL
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDEREMAIL","Visible",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDEREMAIL","Caption","Sender Email")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDEREMAIL","MinWidth","85")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDEREMAIL","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDEREMAIL","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDEREMAIL","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SENDEREMAIL","CellHAlignment","Left")

	'SUBJECT
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SUBJECT","Visible",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SUBJECT","Caption","Sunject")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SUBJECT","MinWidth","85")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SUBJECT","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SUBJECT","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SUBJECT","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","SUBJECT","CellHAlignment","Left")

	'BODY
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BODY","Visible",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BODY","Caption","Body")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BODY","MinWidth","85")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BODY","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BODY","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BODY","HeaderHAlignment","Left")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","BODY","CellHAlignment","Left")

	'PREVIEW
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","ShowCaption",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","Caption","Preview")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","MinWidth","45")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","AllowEdit",False)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","ReadOnly",True)
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","HeaderHAlignment","Center")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","CellHAlignment","Center")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","CellBackColor","Gray")
	Gui.FrmAging.GSGCStatements.SetColumnProperty("gvStatements","PREVIEW","CellForeColor","White")

	Gui.FrmAging.GSGCStatements.ResumeLayout()
	Gui.FrmAging.GSGCStatements.MainView("gvStatements")

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.FormatStatements.End

Program.Sub.cmdSendEmails_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.iCnt.Declare
	V.Local.sSender.Declare
	V.Local.sRecipient.Declare
	V.Local.sSubject.Declare
	V.Local.sBody.Declare
	V.Local.sAttachments.Declare
	V.Local.sFileName.Declare
	V.Local.sSenderEmail.Declare
	V.Local.sSelect.Declare

	F.Intrinsic.Control.If(V.DataTable.dtStatements.Exists,=,False)
		F.Intrinsic.UI.Msgbox("Please load data before emailing.","No data loaded")
		F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.EndIf

	F.Global.Security.GetUserEmail(V.Caller.User,V.Local.sSenderEmail)
	F.Intrinsic.Control.If(V.Local.sSenderEmail,=,"")
		F.Intrinsic.UI.Msgbox("Error in email procedure. The GS User does not have an email address associated with it in User Security Maintenance.","No Email. Try again.")
		F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.EndIf

	F.Data.DataTable.Select("dtStatements","SEL = True And STATEMENT <> ''",V.Local.sSelect)
	F.Intrinsic.Control.If(V.Local.sSelect.IsNoReturn)
		F.Intrinsic.UI.Msgbox("No records are selected.","No Email. Try again.")
		F.Intrinsic.Control.ExitSub
	F.Intrinsic.Control.EndIf

	Gui.FrmAging.lblStatus.Caption("Generating and sending emails....")
	Gui.FrmAging.lblStatus.Visible(True)
	Gui.FrmAging.pbStatus.Visible(True)
	Gui.FrmAging.pbStatus.Min(0)
	F.Intrinsic.Control.If(V.Local.sSelect.UBound,<>,0)
		Gui.FrmAging.pbStatus.Max(V.Local.sSelect.UBound)
	F.Intrinsic.Control.Else
		Gui.FrmAging.pbStatus.Max(100)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.String.Split(V.Local.sSelect,"*!*",V.Local.sSelect)
	F.Intrinsic.Control.For(V.Local.iCnt,0,V.Local.sSelect.UBound,1)
		Gui.FrmAging.pbStatus.Value(V.Local.iCnt)
		F.Intrinsic.Control.If(V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).EMAIL!FieldValTrim,<>,"")
			'Recipient
			F.Intrinsic.String.Build("{0}*!*{1}",V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).CONTACT!FieldValTrim,V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).EMAIL!FieldValTrim,V.Local.sRecipient)
			'Sender
			F.Intrinsic.String.Build("{0}*!*{1}",V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).SENDEREMAIL!FieldValTrim,V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).SENDERNAME!FieldValTrim,V.Local.sSender)
			'Attachment
			F.Intrinsic.String.Split(V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).STATEMENT!FieldValTrim,"\",V.Local.sFileName)
			F.Intrinsic.String.Build("{0}*!*{1}\Statements\",V.Local.sFileName(V.Local.sFileName.UBound).Trim,V.Caller.PluginsDir,V.Local.sAttachments)
			'Subject
			V.Local.sSubject.Set(V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).SUBJECT!FieldValTrim)
			'Body
			V.Local.sBody.Set(V.DataTable.dtStatements(V.Local.sSelect(V.Local.iCnt)).Body!FieldValTrim)
			'Send Email				
			F.Global.Messaging.QueueMessage(V.Caller.CompanyCode,0,"",V.Local.sSubject,V.Local.sSender,V.Local.sRecipient,V.Local.sBody,5,"",False,"","","","","","","",V.Local.sAttachments,False)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.iCnt)

	F.Intrinsic.Control.If(V.Local.sSelect.UBound,<>,0)
		Gui.FrmAging.pbStatus.Value(V.Local.sSelect.UBound)
	F.Intrinsic.Control.Else
		Gui.FrmAging.pbStatus.Value(100)
	F.Intrinsic.Control.EndIf

	Gui.FrmAging.lblStatus.Visible(False)
	Gui.FrmAging.pbStatus.Visible(False)

	Gui.FrmAging.lblStatus.Visible(False)

	F.Data.DataTable.SetValue("dtStatements",-1,"SEL",False)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdSendEmails_Click.End

Program.Sub.frmStatementView_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.frmStatementView.htmlView.Navigate("about:blank")
	Gui.frmStatementView..Visible(False)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmStatementView_UnLoad.End

Program.Sub.GSGCStatements_RowCellClick.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sDir.Declare

	F.Intrinsic.String.Build("{0}\Statements",V.Caller.PluginsDir,V.Local.sDir)
	F.Intrinsic.Control.SelectCase(V.Args.Column)
		F.Intrinsic.Control.Case("STATEMENT")
			F.Intrinsic.Control.If(V.Args.cellvalue.Trim,<>,"")
				Gui.frmStatementView.htmlView.Navigate("about:blank")
				Gui.frmStatementView.htmlView.Navigate(V.Args.cellvalue)
				Gui.frmStatementView..Show
			F.Intrinsic.Control.EndIf

		F.Intrinsic.Control.Case("PREVIEW")
			Gui.frmEmail..Caption("Edit Email")
			Gui.frmEmail.txtSName.Text(V.DataTable.dtStatements(V.Args.RowIndex).SENDERNAME!FieldValTrim)
			Gui.frmEmail.txtSEmail.Text(V.DataTable.dtStatements(V.Args.RowIndex).SENDEREMAIL!FieldValTrim)
			Gui.frmEmail.txtRName.Text(V.DataTable.dtStatements(V.Args.RowIndex).CONTACT!FieldValTrim)
			Gui.frmEmail.txtREmail.Text(V.DataTable.dtStatements(V.Args.RowIndex).EMAIL!FieldValTrim)
			Gui.frmEmail.txtSubject.Text(V.DataTable.dtStatements(V.Args.RowIndex).Subject!FieldValTrim)
			Gui.frmEmail.txtBody.Text(V.DataTable.dtStatements(V.Args.RowIndex).Body!FieldValTrim)
			Gui.frmEmail.txtRow.Text(V.Args.RowIndex)
			Gui.frmEmail..Show
			Gui.frmEmail.txtSName.SetFocus

	F.Intrinsic.Control.EndSelect

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.GSGCStatements_RowCellClick.End

Program.Sub.SerializeStatements.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSerialize.Declare

	'gvStatements
	Gui.FrmAging.GSGCStatements.Serialize("gvStatements",V.Local.sSerialize)
	F.Global.Registry.AddValue(V.Caller.User,V.Caller.CompanyCode,"GVSTATEMENTS",5435,1000,False,"Serialize",False,0,-999.0,1/1/1980,12:00:00 AM,V.Local.sSerialize)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End

	F.Intrinsic.Control.EndTry
Program.Sub.SerializeStatements.End

Program.Sub.DeserializeStatements.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	V.Local.sSerialize.Declare

	'gvStatements
	F.Global.Registry.ReadValue(V.Caller.User,V.Caller.CompanyCode,"GVSTATEMENTS",5435,1000,6,"",V.Local.sSerialize)
	F.Intrinsic.Control.If(V.Local.sSerialize.Trim,<>,"")
		Gui.FrmAging.GSGCStatements.Deserialize(V.Local.sSerialize)
	F.Intrinsic.Control.EndIf

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End

	F.Intrinsic.Control.EndTry
Program.Sub.DeserializeStatements.End

Program.Sub.frmEmail_UnLoad.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	Gui.frmEmail..Visible(False)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.frmEmail_UnLoad.End

Program.Sub.cmdSavePreview_Click.Start
	F.Intrinsic.Control.Try
	V.Local.sError.Declare

	F.Data.DataTable.SetValue("dtStatements",V.Screen.frmEmail!txtRow.Text,"SENDERNAME",V.Screen.frmEmail!txtSName.Text,"SENDEREMAIL",V.Screen.frmEmail!txtSEmail.Text,"CONTACT",V.Screen.frmEmail!txtRName.Text,"EMAIL",V.Screen.frmEmail!txtREmail.Text,"SUBJECT",V.Screen.frmEmail!txtSubject.Text,"BODY",V.Screen.frmEmail!txtBody.Text)
	Gui.frmEmail..Visible(False)

	F.Intrinsic.Control.Catch
		F.Intrinsic.String.Build("Project: {0}{1}{1}Subroutine: {2}{1}Error Occurred {3} with description {4}{1}{1}GAB Version: {5}",V.Ambient.ScriptPath,V.Ambient.Newline,V.Ambient.CurrentSubroutine,V.Ambient.ErrorNumber,V.Ambient.ErrorDescription,V.Ambient.GABVersion,V.Local.sError)
		F.Intrinsic.UI.Msgbox(V.Local.sError)
		F.Intrinsic.Control.End 
	F.Intrinsic.Control.EndTry
Program.Sub.cmdSavePreview_Click.End

Program.Sub.Comments.Start
${$0$}$$}$$}$00:00:00$}$False
${$5$}$2.0.0.0$}$2
${$6$}$along$}$20220707145351793$}$DeaWVT0NVKAj47sG2iEYeCVSyClywHpxazRkHYTZr3qOLMuVhAts+AhECBUEDcPt3vLq+mS1Pp4=
Program.Sub.Comments.End